<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Snowball Calculator | Dave Ramsey Method</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --ramsey-blue: #005288;
            --ramsey-blue-dark: #003d66;
            --ramsey-green: #2E7D32;
            --ramsey-green-light: #4CAF50;
            --ramsey-red: #D32F2F;
            --ramsey-orange: #F57C00;
            --ramsey-gray: #616161;
            --ramsey-gray-light: #F5F5F5;
            --ramsey-gray-dark: #212121;
            --white: #FFFFFF;
            --gold: #FFD700;
            --ramsey-blue-light: #0077B6;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--ramsey-gray-light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: var(--ramsey-gray-dark);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: var(--ramsey-blue);
            color: var(--white);
            padding: 40px 30px;
            text-align: center;
            border-bottom: 5px solid var(--ramsey-green);
        }
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 500px;
            margin: 0 auto;
        }
        .badges-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .earned-badge {
            background: linear-gradient(135deg, var(--gold) 0%, #FFA000 100%);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: badgePop 0.5s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        @keyframes badgePop {
            0% { transform: scale(0) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0); }
        }
        .content { padding: 30px; }
        .countdown-section {
            background: linear-gradient(135deg, var(--ramsey-blue) 0%, var(--ramsey-blue-dark) 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            display: none;
        }
        .countdown-section.show { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .countdown-title { font-size: 1.3rem; margin-bottom: 20px; opacity: 0.9; }
        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .countdown-unit {
            background: rgba(255,255,255,0.15);
            padding: 15px 25px;
            border-radius: 8px;
            min-width: 80px;
        }
        .countdown-value { font-size: 2.5rem; font-weight: 700; }
        .countdown-label { font-size: 0.9rem; opacity: 0.8; text-transform: uppercase; }
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; }
        .method-toggle {
            background: var(--ramsey-gray-light);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid var(--ramsey-blue);
        }
        .method-toggle h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .toggle-wrapper {
            display: flex;
            background: var(--white);
            border-radius: 6px;
            padding: 4px;
            gap: 4px;
            border: 2px solid #e0e0e0;
        }
        .toggle-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--ramsey-gray);
            font-size: 0.95rem;
        }
        .toggle-btn.active {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .method-desc {
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--ramsey-gray);
        }
        .whatif-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px solid var(--ramsey-orange);
        }
        .whatif-section h3 {
            color: #e65100;
            margin-bottom: 15px;
        }
        .whatif-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .whatif-btn {
            background: var(--white);
            border: 2px solid var(--ramsey-orange);
            color: #e65100;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .whatif-btn:hover {
            background: var(--ramsey-orange);
            color: white;
        }
        .whatif-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            display: none;
        }
        .whatif-result.show { display: block; }
        .extra-payment-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px solid var(--ramsey-green);
        }
        .extra-payment-section h3 {
            color: var(--ramsey-green);
            margin-bottom: 10px;
        }
        .slider-container { margin: 20px 0; }
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--ramsey-gray);
        }
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #c8e6c9;
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--ramsey-green);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(46, 125, 50, 0.4);
            border: 3px solid var(--white);
        }
        .extra-amount {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--ramsey-green);
            margin: 20px 0 10px;
        }
        .time-saved {
            text-align: center;
            color: #1b5e20;
            font-weight: 600;
            font-size: 1rem;
            min-height: 24px;
        }
        .input-section h2 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
        }
        .debt-form {
            background: var(--ramsey-gray-light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
        }
        .form-row label {
            font-size: 0.85rem;
            color: var(--ramsey-gray);
            margin-bottom: 6px;
            display: block;
            font-weight: 500;
        }
        .form-row input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .form-row input:focus {
            outline: none;
            border-color: var(--ramsey-blue);
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .btn-primary {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .btn-primary:hover { background: var(--ramsey-blue-dark); }
        .btn-secondary {
            background: var(--ramsey-gray-light);
            color: var(--ramsey-gray-dark);
            border: 2px solid #e0e0e0;
        }
        .btn-danger {
            background: var(--ramsey-red);
            color: var(--white);
            padding: 12px 16px;
        }
        .btn-success {
            background: var(--ramsey-green);
            color: var(--white);
        }
        .btn-outline {
            background: var(--white);
            border: 2px solid var(--ramsey-blue);
            color: var(--ramsey-blue);
        }
        .btn-outline:hover {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        .comparison-card {
            background: var(--white);
            border: 3px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }
        .comparison-card.winner {
            border-color: var(--ramsey-green);
            background: #e8f5e9;
            transform: scale(1.02);
        }
        .comparison-card h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
        }
        .comparison-stat {
            font-size: 2rem;
            font-weight: 700;
            color: var(--ramsey-blue);
            margin: 10px 0;
        }
        .comparison-card.winner .comparison-stat {
            color: var(--ramsey-green);
        }
        .winner-badge {
            display: inline-block;
            background: var(--ramsey-green);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 10px;
            text-transform: uppercase;
        }
        .results { display: none; }
        .results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: var(--ramsey-blue);
            color: var(--white);
            padding: 25px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .summary-card .amount {
            font-size: 2rem;
            font-weight: 700;
        }
        .monthly-breakdown {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .breakdown-table th {
            background: var(--ramsey-blue);
            color: white;
            padding: 12px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        .breakdown-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        .breakdown-table tr:hover { background: var(--ramsey-gray-light); }
        .breakdown-table .paid-off {
            background: #e8f5e9;
            font-weight: 600;
        }
        .debt-list h2 {
            color: var(--ramsey-blue);
            margin-bottom: 20px;
            font-weight: 600;
        }
        .debt-item {
            background: var(--white);
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        .debt-item.paid {
            border-color: var(--ramsey-green);
            background: #e8f5e9;
        }
        .debt-item.current {
            border-color: var(--ramsey-blue);
            box-shadow: 0 0 0 3px rgba(0, 82, 136, 0.1);
        }
        .debt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .debt-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .debt-balance {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--ramsey-red);
        }
        .debt-item.paid .debt-balance {
            color: var(--ramsey-green);
        }
        .progress-bar {
            height: 28px;
            background: #e0e0e0;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--ramsey-red) 0%, #ff9800 50%, var(--ramsey-green) 100%);
            border-radius: 14px;
            transition: width 1s ease;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            color: var(--ramsey-gray-dark);
            font-size: 0.9rem;
        }
        .debt-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        .detail-item { text-align: center; }
        .detail-label {
            font-size: 0.8rem;
            color: var(--ramsey-gray);
            margin-bottom: 5px;
        }
        .detail-value {
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge-current {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .badge-paid {
            background: var(--ramsey-green);
            color: var(--white);
        }
        .badge-upcoming {
            background: #e0e0e0;
            color: var(--ramsey-gray);
        }
        .timeline {
            margin-top: 30px;
            padding: 25px;
            background: var(--ramsey-gray-light);
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .timeline h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-weight: 600;
        }
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ddd;
        }
        .timeline-date {
            width: 120px;
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .celebration {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 8px;
            margin-top: 30px;
            display: none;
            border: 3px solid var(--ramsey-green);
        }
        .celebration.show {
            display: block;
            animation: celebrate 0.5s ease;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }
        .celebration h2 {
            color: var(--ramsey-green);
            font-size: 2.2rem;
            margin-bottom: 15px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .share-card {
            background: var(--white);
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
            border: 3px solid var(--ramsey-green);
        }
        .share-card h2 {
            color: var(--ramsey-blue);
            margin-bottom: 20px;
        }
        .share-stat {
            font-size: 3rem;
            font-weight: 700;
            color: var(--ramsey-green);
            margin: 15px 0;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .loading.show { display: block; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: var(--ramsey-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-message {
            background: #ffebee;
            color: var(--ramsey-red);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid var(--ramsey-red);
            display: none;
        }
        .error-message.show { display: block; }
        .affiliate-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px solid var(--ramsey-blue-light);
        }
        .affiliate-section h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
        }
        .affiliate-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .affiliate-link {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--ramsey-gray-dark);
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }
        .affiliate-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: var(--ramsey-blue);
        }
        .affiliate-link strong {
            color: var(--ramsey-blue);
            display: block;
            margin-bottom: 5px;
        }
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .comparison-section { grid-template-columns: 1fr; }
            .countdown-timer { gap: 10px; }
            .countdown-unit {
                padding: 10px 15px;
                min-width: 60px;
            }
            .countdown-value { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Debt Snowball Calculator</h1>
            <p>Calculate your path to debt freedom using Dave Ramsey's proven method</p>
            <div class="badges-display" id="earnedBadges"></div>
        </div>

        <div class="content">
            <div id="errorMessage" class="error-message"></div>

            <div id="countdownSection" class="countdown-section">
                <div class="countdown-title">‚è∞ Time Until You're Debt Free!</div>
                <div class="countdown-timer" id="countdownTimer"></div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-secondary btn-small" onclick="loadExample()">üìã Load Example</button>
                <button class="btn btn-secondary btn-small" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>

            <div class="method-toggle">
                <h3>Choose Your Strategy</h3>
                <div class="toggle-wrapper">
                    <button class="toggle-btn active" onclick="setMethod('snowball')" id="snowballBtn">üèîÔ∏è Debt Snowball</button>
                    <button class="toggle-btn" onclick="setMethod('avalanche')" id="avalancheBtn">üèîÔ∏è Debt Avalanche</button>
                </div>
                <p class="method-desc" id="methodDesc">
                    <strong>Debt Snowball:</strong> Pay smallest debts first for quick wins and motivation.
                </p>
            </div>

            <div class="whatif-section">
                <h3>ü§î What If Scenarios</h3>
                <div class="whatif-buttons">
                    <button class="whatif-btn" onclick="whatIfExtra(50)">+$50/month</button>
                    <button class="whatif-btn" onclick="whatIfExtra(200)">+$200/month</button>
                    <button class="whatif-btn" onclick="whatIfBonus(1000)">+$1,000 bonus</button>
                    <button class="whatif-btn" onclick="whatIfBonus(5000)">+$5,000 bonus</button>
                </div>
                <div id="whatifResult" class="whatif-result"></div>
            </div>

            <div class="extra-payment-section">
                <h3>‚ö° Extra Monthly Payment</h3>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>$0</span>
                        <span>$500</span>
                        <span>$1,000</span>
                        <span>$2,000+</span>
                    </div>
                    <input type="range" class="slider" id="extraPayment" min="0" max="2000" step="50" value="0" oninput="updateExtraPayment(this.value)">
                </div>
                <div class="extra-amount" id="extraAmount">$0</div>
                <div class="time-saved" id="timeSaved"></div>
            </div>

            <div class="input-section">
                <h2>Enter Your Debts</h2>
                <div id="debtInputs">
                    <div class="debt-form">
                        <div class="form-row">
                            <div>
                                <label>Debt Name</label>
                                <input type="text" class="debt-name-input" placeholder="e.g., Chase Credit Card">
                            </div>
                            <div>
                                <label>Balance ($)</label>
                                <input type="number" class="debt-balance-input" placeholder="0" min="0" step="0.01">
                            </div>
                            <div>
                                <label>Min Payment ($)</label>
                                <input type="number" class="debt-payment-input" placeholder="0" min="0" step="0.01">
                            </div>
                            <div>
                                <label>Interest Rate (%)</label>
                                <input type="number" class="debt-rate-input" placeholder="0" min="0" step="0.01">
                            </div>
                            <button class="btn btn-danger" onclick="removeDebt(this)" style="display:none">‚úï</button>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="addDebtInput()">+ Add Another Debt</button>
                    <button class="btn btn-primary" onclick="calculateSnowball()">üí™ Calculate My Payoff</button>
                </div>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Crunching the numbers...</p>
            </div>

            <div id="results" class="results">
                <div class="comparison-section" id="comparisonSection" style="display:none;">
                    <div class="comparison-card" id="snowballCard">
                        <h3>üèîÔ∏è Snowball</h3>
                        <div class="comparison-stat" id="snowballTime">0 months</div>
                        <p>Payoff Time</p>
                        <div class="comparison-stat" id="snowballInterest">$0</div>
                        <p>Total Interest</p>
                    </div>
                    <div class="comparison-card" id="avalancheCard">
                        <h3>üèîÔ∏è Avalanche</h3>
                        <div class="comparison-stat" id="avalancheTime">0 months</div>
                        <p>Payoff Time</p>
                        <div class="comparison-stat" id="avalancheInterest">$0</div>
                        <p>Total Interest</p>
                    </div>
                </div>

                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Debt</h3>
                        <div class="amount" id="totalDebt">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Monthly Payments</h3>
                        <div class="amount" id="totalPayments">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Debt-Free Date</h3>
                        <div class="amount" id="debtFreeDate">-</div>
                    </div>
                    <div class="summary-card">
                        <h3>Interest Saved</h3>
                        <div class="amount" id="interestSaved">$0</div>
                    </div>
                </div>

                <div class="timeline">
                    <h3>üìÖ Month-by-Month Breakdown</h3>
                    <div class="monthly-breakdown">
                        <table class="breakdown-table" id="breakdownTable">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Debt Target</th>
                                    <th>Minimum</th>
                                    <th>Extra</th>
                                    <th>Total Paid</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="breakdownBody"></tbody>
                        </table>
                    </div>
                </div>

                <div style="margin: 30px 0;">
                    <h3 style="color: var(--ramsey-blue); margin-bottom: 15px;">üì§ Export & Share</h3>
                    <div class="action-buttons">
                        <button class="btn btn-outline" onclick="printPlan()">üñ®Ô∏è Print</button>
                        <button class="btn btn-outline" onclick="generateColoringTracker()">üé® Coloring Tracker</button>
                        <button class="btn btn-outline" onclick="exportCSV()">üìä Export CSV</button>
                        <button class="btn btn-outline" onclick="exportCalendar()">üìÖ Calendar</button>
                        <button class="btn btn-success" onclick="showShareModal()">üì∏ Share</button>
                    </div>
                    <p style="color: var(--ramsey-gray); font-size: 0.9rem; margin-top: 10px;">
                        üí° <strong>Tip:</strong> The Coloring Tracker creates a printable page you can color in as you pay off debt!
                    </p>
                </div>

                <div class="debt-list">
                    <h2>üìä Your Debt Payoff Order</h2>
                    <div id="debtList"></div>
                </div>

                <div id="celebration" class="celebration">
                    <h2>üéâ You're Debt Free!</h2>
                    <p id="celebrationMessage"></p>
                    <div id="earnedBadgesCelebration" style="margin-top: 20px;"></div>
                </div>

                <div class="affiliate-section">
                    <h3>üìö Continue Your Journey</h3>
                    <div class="affiliate-links">
                        <a href="https://www.ramseysolutions.com/store/financial-peace-university" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üìñ Financial Peace University</strong>
                            Dave Ramsey's complete money course
                        </a>
                        <a href="https://www.ramseysolutions.com/store/the-total-money-makeover" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üìö The Total Money Makeover</strong>
                            The book that started it all
                        </a>
                        <a href="https://www.ramseysolutions.com/store/everydollar" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üí∞ EveryDollar App</strong>
                            Track your budget and debt progress
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="shareModal">
        <div class="modal" style="max-width: 700px;">
            <div id="shareContent">
                <div class="share-card">
                    <h2>üéØ My Debt-Free Journey</h2>
                    <div class="share-stat" id="shareDebtFreeDate">-</div>
                    <p style="font-size: 1.3rem; color: #616161;">Debt-Free Date</p>
                    <div id="shareBadges" style="margin: 20px 0;"></div>
                    <div id="shareMessage"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="downloadImage()">üíæ Download</button>
                <button class="btn btn-primary" onclick="shareTwitter()">üê¶ Tweet</button>
                <button class="btn btn-secondary" onclick="closeModal('shareModal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        let debtCount = 1;
        let currentMethod = 'snowball';
        let extraPaymentAmount = 0;
        let lastCalculatedDebts = [];
        let lastResults = null;
        let earnedBadges = JSON.parse(localStorage.getItem('debtBadges') || '[]');
        let countdownInterval = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            displayBadges();
        });

        function loadSavedData() {
            const saved = localStorage.getItem('debtSnowballData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.debts?.length > 0) {
                        document.getElementById('debtInputs').innerHTML = '';
                        debtCount = 0;
                        data.debts.forEach(debt => {
                            addDebtInput();
                            const forms = document.querySelectorAll('.debt-form');
                            const lastForm = forms[forms.length - 1];
                            lastForm.querySelector('.debt-name-input').value = debt.name || '';
                            lastForm.querySelector('.debt-balance-input').value = debt.balance || '';
                            lastForm.querySelector('.debt-payment-input').value = debt.payment || '';
                            lastForm.querySelector('.debt-rate-input').value = debt.rate || '';
                        });
                    }
                    if (data.extraPayment) {
                        extraPaymentAmount = data.extraPayment;
                        document.getElementById('extraPayment').value = extraPaymentAmount;
                        document.getElementById('extraAmount').textContent = '$' + extraPaymentAmount.toLocaleString();
                    }
                    if (data.method) setMethod(data.method);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        function saveData() {
            const debts = [];
            document.querySelectorAll('.debt-form').forEach(form => {
                debts.push({
                    name: form.querySelector('.debt-name-input').value || '',
                    balance: form.querySelector('.debt-balance-input').value || '',
                    payment: form.querySelector('.debt-payment-input').value || '',
                    rate: form.querySelector('.debt-rate-input').value || ''
                });
            });
            localStorage.setItem('debtSnowballData', JSON.stringify({
                debts, extraPayment: extraPaymentAmount, method: currentMethod
            }));
        }

        function loadExample() {
            document.getElementById('debtInputs').innerHTML = '';
            debtCount = 0;
            const examples = [
                { name: 'Visa Credit Card', balance: 3500, payment: 85, rate: 19.99 },
                { name: 'Mastercard', balance: 2200, payment: 60, rate: 17.99 },
                { name: 'Car Loan', balance: 12500, payment: 350, rate: 5.99 },
                { name: 'Student Loan', balance: 8500, payment: 200, rate: 4.5 }
            ];
            examples.forEach(debt => {
                addDebtInput();
                const forms = document.querySelectorAll('.debt-form');
                const lastForm = forms[forms.length - 1];
                lastForm.querySelector('.debt-name-input').value = debt.name;
                lastForm.querySelector('.debt-balance-input').value = debt.balance;
                lastForm.querySelector('.debt-payment-input').value = debt.payment;
                lastForm.querySelector('.debt-rate-input').value = debt.rate;
            });
            saveData();
            awardBadge('explorer');
        }

        function clearAll() {
            if (confirm('Clear all debts?')) {
                document.getElementById('debtInputs').innerHTML = '';
                debtCount = 0;
                addDebtInput();
                saveData();
            }
        }

        function awardBadge(badgeId) {
            const badges = {
                explorer: { icon: 'üîç', name: 'Explorer', desc: 'Loaded example data' },
                calculator: { icon: 'üßÆ', name: 'Calculator', desc: 'Ran first calculation' },
                snowball: { icon: 'üèîÔ∏è', name: 'Snowball Starter', desc: 'Used snowball method' },
                avalanche: { icon: '‚õ∞Ô∏è', name: 'Avalanche Pro', desc: 'Used avalanche method' },
                extramiler: { icon: '‚ö°', name: 'Extra Miler', desc: 'Added extra payments' },
                debtfree: { icon: 'üéâ', name: 'Debt Free Dreamer', desc: 'Calculated debt-free date' },
                firstdebt: { icon: 'üéØ', name: 'First Blood', desc: 'Paid off first debt in simulation' },
                halfway: { icon: 'üìà', name: 'Halfway Hero', desc: '50% to debt free' },
                saver: { icon: 'üí∞', name: 'Super Saver', desc: 'Saved $1000+ in interest' }
            };
            if (!earnedBadges.includes(badgeId) && badges[badgeId]) {
                earnedBadges.push(badgeId);
                localStorage.setItem('debtBadges', JSON.stringify(earnedBadges));
                displayBadges();
            }
        }

        function displayBadges() {
            const badges = {
                explorer: { icon: 'üîç', name: 'Explorer' },
                calculator: { icon: 'üßÆ', name: 'Calculator' },
                snowball: { icon: 'üèîÔ∏è', name: 'Snowball' },
                avalanche: { icon: '‚õ∞Ô∏è', name: 'Avalanche' },
                extramiler: { icon: '‚ö°', name: 'Extra Miler' },
                debtfree: { icon: 'üéâ', name: 'Debt Free' },
                firstdebt: { icon: 'üéØ', name: 'First Win' },
                halfway: { icon: 'üìà', name: 'Halfway' },
                saver: { icon: 'üí∞', name: 'Super Saver' }
            };
            const container = document.getElementById('earnedBadges');
            container.innerHTML = earnedBadges.map(id => {
                const badge = badges[id];
                return `<div class="earned-badge">${badge.icon} ${badge.name}</div>`;
            }).join('');
        }

        function startCountdown(targetDate) {
            if (countdownInterval) clearInterval(countdownInterval);
            const section = document.getElementById('countdownSection');
            section.classList.add('show');
            function update() {
                const now = new Date();
                const diff = targetDate - now;
                if (diff <= 0) {
                    document.getElementById('countdownTimer').innerHTML = '<div class="countdown-unit"><div class="countdown-value">üéâ</div><div class="countdown-label">DEBT FREE!</div></div>';
                    return;
                }
                const years = Math.floor(diff / (365.25 * 24 * 60 * 60 * 1000));
                const months = Math.floor((diff % (365.25 * 24 * 60 * 60 * 1000)) / (30.44 * 24 * 60 * 60 * 1000));
                const days = Math.floor((diff % (30.44 * 24 * 60 * 60 * 1000)) / (24 * 60 * 60 * 1000));
                const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                document.getElementById('countdownTimer').innerHTML = `
                    ${years > 0 ? `<div class="countdown-unit"><div class="countdown-value">${years}</div><div class="countdown-label">Years</div></div>` : ''}
                    ${months > 0 ? `<div class="countdown-unit"><div class="countdown-value">${months}</div><div class="countdown-label">Months</div></div>` : ''}
                    <div class="countdown-unit"><div class="countdown-value">${days}</div><div class="countdown-label">Days</div></div>
                    <div class="countdown-unit"><div class="countdown-value">${hours}</div><div class="countdown-label">Hours</div></div>
                `;
            }
            update();
            countdownInterval = setInterval(update, 60000);
        }

        function whatIfExtra(amount) {
            if (lastCalculatedDebts.length === 0) {
                showError('Calculate your plan first!');
                return;
            }
            const baseResult = calculatePayoff(JSON.parse(JSON.stringify(lastCalculatedDebts)), currentMethod, 0);
            const extraResult = calculatePayoff(JSON.parse(JSON.stringify(lastCalculatedDebts)), currentMethod, amount);
            const monthsSaved = baseResult.months - extraResult.months;
            const interestSaved = baseResult.totalInterest - extraResult.totalInterest;
            const resultEl = document.getElementById('whatifResult');
            resultEl.innerHTML = `
                <strong>What if you pay $${amount} extra per month?</strong><br>
                üéâ You'd be debt-free <strong>${monthsSaved} months sooner</strong>!<br>
                üí∞ And save <strong>$${Math.round(interestSaved).toLocaleString()}</strong> in interest!
            `;
            resultEl.classList.add('show');
        }

        function whatIfBonus(amount) {
            if (lastCalculatedDebts.length === 0) {
                showError('Calculate your plan first!');
                return;
            }
            const debts = JSON.parse(JSON.stringify(lastCalculatedDebts));
            const baseResult = calculatePayoff(debts, currentMethod, extraPaymentAmount);
            debts[0].balance = Math.max(0, debts[0].balance - amount);
            const bonusResult = calculatePayoff(debts, currentMethod, extraPaymentAmount);
            const monthsSaved = baseResult.months - bonusResult.months;
            const interestSaved = baseResult.totalInterest - bonusResult.totalInterest;
            const resultEl = document.getElementById('whatifResult');
            resultEl.innerHTML = `
                <strong>What if you apply a $${amount.toLocaleString()} bonus?</strong><br>
                üéâ You'd be debt-free <strong>${monthsSaved} month${monthsSaved !== 1 ? 's' : ''} sooner</strong>!<br>
                üí∞ And save <strong>$${Math.round(interestSaved).toLocaleString()}</strong> in interest!
            `;
            resultEl.classList.add('show');
        }

        function setMethod(method) {
            currentMethod = method;
            document.getElementById('snowballBtn').classList.toggle('active', method === 'snowball');
            document.getElementById('avalancheBtn').classList.toggle('active', method === 'avalanche');
            const desc = method === 'snowball' 
                ? '<strong>Debt Snowball:</strong> Pay smallest debts first for quick wins and motivation.'
                : '<strong>Debt Avalanche:</strong> Pay highest interest debts first to save the most money.';
            document.getElementById('methodDesc').innerHTML = desc;
            saveData();
            if (lastCalculatedDebts.length > 0) calculateSnowball();
        }

        function addDebtInput() {
            debtCount++;
            const container = document.getElementById('debtInputs');
            const newDebt = document.createElement('div');
            newDebt.className = 'debt-form';
            newDebt.innerHTML = `
                <div class="form-row">
                    <div><label>Debt Name</label><input type="text" class="debt-name-input" placeholder="e.g., Credit Card ${debtCount}"></div>
                    <div><label>Balance ($)</label><input type="number" class="debt-balance-input" placeholder="0" min="0" step="0.01"></div>
                    <div><label>Min Payment ($)</label><input type="number" class="debt-payment-input" placeholder="0" min="0" step="0.01"></div>
                    <div><label>Interest Rate (%)</label><input type="number" class="debt-rate-input" placeholder="0" min="0" step="0.01"></div>
                    <button class="btn btn-danger" onclick="removeDebt(this)">‚úï</button>
                </div>
            `;
            container.appendChild(newDebt);
            updateRemoveButtons();
        }

        function removeDebt(btn) {
            btn.closest('.debt-form').remove();
            updateRemoveButtons();
            saveData();
        }

        function updateRemoveButtons() {
            const forms = document.querySelectorAll('.debt-form');
            const showRemove = forms.length > 1;
            forms.forEach(form => {
                const btn = form.querySelector('.btn-danger');
                if (btn) btn.style.display = showRemove ? 'inline-block' : 'none';
            });
        }

        function updateExtraPayment(value) {
            extraPaymentAmount = parseInt(value) || 0;
            document.getElementById('extraAmount').textContent = '$' + extraPaymentAmount.toLocaleString();
            saveData();
            if (lastCalculatedDebts.length > 0) calculateSnowball();
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        function validateDebts(debts) {
            if (debts.length === 0) return 'Please enter at least one debt.';
            for (let debt of debts) {
                if (debt.balance <= 0) return `Balance for "${debt.name}" must be greater than 0.`;
                if (debt.payment <= 0) return `Minimum payment for "${debt.name}" must be greater than 0.`;
                if (debt.payment >= debt.balance) return `Minimum payment for "${debt.name}" should be less than the balance.`;
            }
            return null;
        }

        function calculateSnowball() {
            const debts = [];
            document.querySelectorAll('.debt-form').forEach((form, index) => {
                const name = (form.querySelector('.debt-name-input').value || `Debt ${index + 1}`).trim();
                const balance = parseFloat(form.querySelector('.debt-balance-input').value) || 0;
                const payment = parseFloat(form.querySelector('.debt-payment-input').value) || 0;
                const rate = parseFloat(form.querySelector('.debt-rate-input').value) || 0;
                if (balance > 0) debts.push({ name, balance, payment, rate, originalBalance: balance });
            });

            const validationError = validateDebts(debts);
            if (validationError) {
                showError(validationError);
                return;
            }

            lastCalculatedDebts = JSON.parse(JSON.stringify(debts));
            saveData();
            awardBadge('calculator');
            if (currentMethod === 'snowball') awardBadge('snowball');
            else awardBadge('avalanche');
            if (extraPaymentAmount > 0) awardBadge('extramiler');

            const snowballResult = calculatePayoff(JSON.parse(JSON.stringify(debts)), 'snowball');
            const avalancheResult = calculatePayoff(JSON.parse(JSON.stringify(debts)), 'avalanche');
            lastResults = { snowball: snowballResult, avalanche: avalancheResult };

            showComparison(snowballResult, avalancheResult);
            const selectedResult = currentMethod === 'snowball' ? snowballResult : avalancheResult;
            displayResults(selectedResult, debts);
            
            const noExtra = calculatePayoff(JSON.parse(JSON.stringify(debts)), currentMethod, 0);
            const interestSaved = noExtra.totalInterest - selectedResult.totalInterest;
            if (interestSaved >= 1000) awardBadge('saver');
            
            startCountdown(selectedResult.finalDate);
        }

        function calculatePayoff(debts, method, extra = extraPaymentAmount) {
            debts = debts.map(d => ({...d, balance: parseFloat(d.balance), paidOff: null}));
            if (method === 'snowball') debts.sort((a, b) => a.balance - b.balance);
            else debts.sort((a, b) => b.rate - a.rate);

            let month = 0, totalInterest = 0;
            const timeline = [], monthlyBreakdown = [];
            const maxMonths = 600;
            const startDate = new Date();

            while (month < maxMonths) {
                month++;
                let monthInterest = 0, extraPayment = extra;
                const targetDebt = debts.find(d => d.balance > 0.01);

                debts.forEach(debt => {
                    if (debt.balance > 0.01) {
                        const monthlyRate = debt.rate / 100 / 12;
                        const interest = parseFloat((debt.balance * monthlyRate).toFixed(2));
                        monthInterest += interest;
                        debt.balance = parseFloat((debt.balance + interest).toFixed(2));
                        const payment = Math.min(debt.payment, debt.balance);
                        debt.balance = parseFloat((debt.balance - payment).toFixed(2));

                        if (debt.balance <= 0.01) {
                            debt.balance = 0;
                            if (!debt.paidOff) {
                                debt.paidOff = month;
                                const date = new Date(startDate);
                                date.setMonth(date.getMonth() + month);
                                timeline.push({ month, date: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }), debt: debt.name });
                            }
                        }
                    }
                });

                totalInterest = parseFloat((totalInterest + monthInterest).toFixed(2));

                for (let debt of debts) {
                    if (debt.balance > 0.01) {
                        debt.balance = Math.max(0, parseFloat((debt.balance - extraPayment).toFixed(2)));
                        if (debt.balance <= 0.01 && !debt.paidOff) {
                            debt.paidOff = month;
                            const date = new Date(startDate);
                            date.setMonth(date.getMonth() + month);
                            timeline.push({ month, date: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }), debt: debt.name });
                        }
                        break;
                    }
                }

                monthlyBreakdown.push({
                    month,
                    target: targetDebt?.name || 'None',
                    minimum: debts.reduce((sum, d) => sum + (d.originalBalance > 0 ? d.payment : 0), 0),
                    extra: extra,
                    total: debts.reduce((sum, d) => sum + d.payment, 0) + extra,
                    status: targetDebt?.paidOff === month ? 'PAID OFF! üéâ' : 'Paying down'
                });

                if (debts.every(d => d.balance <= 0.01)) break;
            }

            const finalDate = new Date(startDate);
            finalDate.setMonth(finalDate.getMonth() + month);

            return { months: month, totalInterest, timeline, finalDate, debts, monthlyBreakdown };
        }

        function showComparison(snowball, avalanche) {
            document.getElementById('comparisonSection').style.display = 'grid';
            document.getElementById('snowballTime').textContent = snowball.months + ' months';
            document.getElementById('snowballInterest').textContent = formatMoney(snowball.totalInterest);
            document.getElementById('avalancheTime').textContent = avalanche.months + ' months';
            document.getElementById('avalancheInterest').textContent = formatMoney(avalanche.totalInterest);

            const snowballCard = document.getElementById('snowballCard');
            const avalancheCard = document.getElementById('avalancheCard');
            snowballCard.classList.remove('winner');
            avalancheCard.classList.remove('winner');
            snowballCard.querySelector('.winner-badge')?.remove();
            avalancheCard.querySelector('.winner-badge')?.remove();

            if (avalanche.months <= snowball.months && avalanche.totalInterest <= snowball.totalInterest) {
                avalancheCard.classList.add('winner');
                avalancheCard.insertAdjacentHTML('beforeend', '<span class="winner-badge">üèÜ Recommended</span>');
            } else if (snowball.months <= avalanche.months) {
                snowballCard.classList.add('winner');
                snowballCard.insertAdjacentHTML('beforeend', '<span class="winner-badge">üèÜ Recommended</span>');
            }
        }

        function displayResults(result, originalDebts) {
            const totalDebt = originalDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const totalPayment = originalDebts.reduce((sum, d) => sum + d.payment, 0) + extraPaymentAmount;

            document.getElementById('totalDebt').textContent = formatMoney(totalDebt);
            document.getElementById('totalPayments').textContent = formatMoney(totalPayment);
            document.getElementById('debtFreeDate').textContent = result.finalDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            const noExtra = calculatePayoff(JSON.parse(JSON.stringify(originalDebts)), currentMethod, 0);
            const interestSaved = Math.max(0, noExtra.totalInterest - result.totalInterest);
            document.getElementById('interestSaved').textContent = formatMoney(interestSaved);

            const tbody = document.getElementById('breakdownBody');
            tbody.innerHTML = result.monthlyBreakdown.map(m => `
                <tr class="${m.status.includes('PAID') ? 'paid-off' : ''}">
                    <td>${m.month}</td>
                    <td>${m.target}</td>
                    <td>$${m.minimum.toLocaleString()}</td>
                    <td>$${m.extra.toLocaleString()}</td>
                    <td>$${m.total.toLocaleString()}</td>
                    <td>${m.status}</td>
                </tr>
            `).join('');

            let debtListHTML = '';
            result.debts.forEach((debt, index) => {
                const original = originalDebts.find(d => d.name === debt.name);
                const isPaid = debt.paidOff > 0;
                const isCurrent = !isPaid && result.debts.findIndex(d => d.name === debt.name && !d.paidOff) === result.debts.findIndex(d => !d.paidOff);
                const percentPaid = isPaid ? 100 : Math.max(0, Math.min(100, ((original.originalBalance - debt.balance) / original.originalBalance * 100)));
                
                debtListHTML += `
                    <div class="debt-item ${isPaid ? 'paid' : ''} ${isCurrent ? 'current' : ''}">
                        <div class="debt-header">
                            <div>
                                <span class="debt-name">${index + 1}. ${debt.name}</span>
                                ${isCurrent ? '<span class="badge badge-current">‚ö° Focus Here</span>' : ''}
                                ${isPaid ? '<span class="badge badge-paid">‚úì Paid Off</span>' : ''}
                                ${!isPaid && !isCurrent ? '<span class="badge badge-upcoming">Up Next</span>' : ''}
                            </div>
                            <div class="debt-balance">${formatMoney(original.originalBalance)}</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentPaid}%"></div>
                            <div class="progress-text">${percentPaid.toFixed(0)}% Complete</div>
                        </div>
                        <div class="debt-details">
                            <div class="detail-item"><div class="detail-label">Payment</div><div class="detail-value">${formatMoney(original.payment)}/mo</div></div>
                            <div class="detail-item"><div class="detail-label">Rate</div><div class="detail-value">${original.rate}%</div></div>
                            <div class="detail-item"><div class="detail-label">${isPaid ? 'Paid Off' : 'Order'}</div><div class="detail-value">${isPaid ? debt.paidOff + ' mo' : '#' + (index + 1)}</div></div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('debtList').innerHTML = debtListHTML;

            const paidOffCount = result.debts.filter(d => d.paidOff > 0).length;
            if (paidOffCount >= result.debts.length / 2) awardBadge('halfway');
            if (paidOffCount > 0) awardBadge('firstdebt');

            const celebration = document.getElementById('celebration');
            celebration.classList.add('show');
            document.getElementById('celebrationMessage').innerHTML = 
                `Following this plan, you'll be completely debt-free by <strong>${result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</strong>.<br>Imagine how that will feel!`;

            document.getElementById('shareDebtFreeDate').textContent = result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('shareMessage').textContent = 
                `I'm on track to pay off ${formatMoney(totalDebt)} in debt using the ${currentMethod} method${extraPaymentAmount > 0 ? ' with ' + formatMoney(extraPaymentAmount) + '/mo extra' : ''}!`;
            document.getElementById('shareBadges').innerHTML = earnedBadges.map(id => {
                const badges = { explorer: 'üîç', calculator: 'üßÆ', snowball: 'üèîÔ∏è', avalanche: '‚õ∞Ô∏è', extramiler: '‚ö°', debtfree: 'üéâ', firstdebt: 'üéØ', halfway: 'üìà', saver: 'üí∞' };
                return `<span style="font-size: 1.5rem; margin: 0 5px;">${badges[id]}</span>`;
            }).join('');

            document.getElementById('results').classList.add('show');
        }

        function formatMoney(amount) {
            return '$' + Math.round(amount).toLocaleString();
        }

        function printPlan() { window.print(); }
        
        async function downloadPDF() {
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const otherResult = currentMethod === 'snowball' ? lastResults.avalanche : lastResults.snowball;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const totalPayment = lastCalculatedDebts.reduce((sum, d) => sum + d.payment, 0) + extraPaymentAmount;
            
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            const pageWidth = 210;
            const margin = 15;
            let y = 20;
            
            // Header
            pdf.setFillColor(0, 82, 136);
            pdf.rect(0, 0, pageWidth, 35, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(22);
            pdf.text('MY DEBT-FREE JOURNEY', pageWidth/2, 18, { align: 'center' });
            pdf.setFontSize(11);
            pdf.text(`Plan Created: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`, pageWidth/2, 30, { align: 'center' });
            
            y = 42;
            pdf.setTextColor(0, 0, 0);
            
            // BIG GOAL BOX
            pdf.setFillColor(232, 245, 233);
            pdf.roundedRect(margin, y, pageWidth - margin*2, 28, 3, 3, 'F');
            pdf.setTextColor(46, 125, 50);
            pdf.setFontSize(10);
            pdf.text('DEBT-FREE DATE', margin + 5, y + 8);
            pdf.setFontSize(18);
            pdf.setFont(undefined, 'bold');
            pdf.text(result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }).toUpperCase(), margin + 5, y + 22);
            pdf.setFont(undefined, 'normal');
            pdf.setFontSize(10);
            pdf.text(`${result.months} months from now`, pageWidth - margin - 5, y + 22, { align: 'right' });
            pdf.setTextColor(0, 0, 0);
            y += 35;
            
            // Summary Grid
            pdf.setFontSize(14);
            pdf.setTextColor(0, 82, 136);
            pdf.text('SNAPSHOT', margin, y);
            y += 8;
            
            const colWidth = (pageWidth - margin*2) / 2;
            const rowHeight = 12;
            
            // Box 1: Total Debt
            pdf.setDrawColor(200, 200, 200);
            pdf.setFillColor(250, 250, 250);
            pdf.rect(margin, y, colWidth - 2, rowHeight, 'FD');
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('TOTAL DEBT', margin + 3, y + 5);
            pdf.setFontSize(12);
            pdf.setTextColor(211, 47, 47);
            pdf.setFont(undefined, 'bold');
            pdf.text(formatMoney(totalDebt), margin + 3, y + 10);
            pdf.setFont(undefined, 'normal');
            
            // Box 2: Monthly Payment
            pdf.rect(margin + colWidth, y, colWidth - 2, rowHeight, 'FD');
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('MONTHLY PAYMENT', margin + colWidth + 3, y + 5);
            pdf.setFontSize(12);
            pdf.setTextColor(0, 82, 136);
            pdf.setFont(undefined, 'bold');
            pdf.text(formatMoney(totalPayment), margin + colWidth + 3, y + 10);
            pdf.setFont(undefined, 'normal');
            y += rowHeight + 3;
            
            // Box 3: Method
            pdf.rect(margin, y, colWidth - 2, rowHeight, 'FD');
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('PAYOFF METHOD', margin + 3, y + 5);
            pdf.setFontSize(11);
            pdf.setTextColor(0, 0, 0);
            pdf.text(currentMethod === 'snowball' ? 'Debt Snowball üèîÔ∏è' : 'Debt Avalanche ‚õ∞Ô∏è', margin + 3, y + 10);
            
            // Box 4: Interest
            pdf.rect(margin + colWidth, y, colWidth - 2, rowHeight, 'FD');
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('TOTAL INTEREST', margin + colWidth + 3, y + 5);
            pdf.setFontSize(11);
            pdf.setTextColor(211, 47, 47);
            pdf.text(formatMoney(result.totalInterest), margin + colWidth + 3, y + 10);
            y += rowHeight + 8;
            
            // Compare with other method
            const interestDiff = otherResult.totalInterest - result.totalInterest;
            if (interestDiff > 0) {
                pdf.setFillColor(255, 243, 224);
                pdf.roundedRect(margin, y, pageWidth - margin*2, 14, 2, 2, 'F');
                pdf.setFontSize(9);
                pdf.setTextColor(230, 81, 0);
                pdf.text(`üí° You're saving ${formatMoney(interestDiff)} in interest vs the ${currentMethod === 'snowball' ? 'Avalanche' : 'Snowball'} method!`, margin + 5, y + 9);
                y += 20;
            }
            
            // Milestones Section
            pdf.setFontSize(14);
            pdf.setTextColor(0, 82, 136);
            pdf.text('VICTORY MILESTONES üèÜ', margin, y);
            y += 10;
            
            const milestones = [];
            result.debts.forEach((debt, index) => {
                if (debt.paidOff) {
                    const original = lastCalculatedDebts.find(d => d.name === debt.name);
                    milestones.push({
                        month: debt.paidOff,
                        name: debt.name,
                        amount: original.originalBalance,
                        isFirst: index === 0
                    });
                }
            });
            milestones.sort((a, b) => a.month - b.month);
            
            if (milestones.length > 0) {
                pdf.setFontSize(9);
                milestones.slice(0, 6).forEach((m, i) => {
                    if (y > 270) {
                        pdf.addPage();
                        y = 20;
                    }
                    
                    const emoji = m.isFirst ? 'üéâ' : '‚úì';
                    const date = new Date();
                    date.setMonth(date.getMonth() + m.month);
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    
                    pdf.setFillColor(i % 2 === 0 ? 245 : 255, i % 2 === 0 ? 245 : 255, i % 2 === 0 ? 245 : 255);
                    pdf.rect(margin, y, pageWidth - margin*2, 10, 'F');
                    
                    pdf.setTextColor(46, 125, 50);
                    pdf.text(emoji, margin + 3, y + 7);
                    pdf.setTextColor(0, 0, 0);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`${m.name} PAID OFF!`, margin + 10, y + 7);
                    pdf.setFont(undefined, 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text(`${dateStr} (Month ${m.month})`, pageWidth - margin - 3, y + 7, { align: 'right' });
                    y += 11;
                });
            }
            y += 5;
            
            // Payment Tracker Section
            pdf.setFontSize(14);
            pdf.setTextColor(0, 82, 136);
            pdf.text('PAYMENT TRACKER', margin, y);
            pdf.setFontSize(8);
            pdf.setTextColor(100, 100, 100);
            pdf.text('Check off each month as you pay!', margin + 60, y);
            y += 8;
            
            // Header row
            pdf.setFillColor(0, 82, 136);
            pdf.rect(margin, y, pageWidth - margin*2, 8, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(8);
            pdf.text('Month', margin + 2, y + 5.5);
            pdf.text('Focus On', margin + 25, y + 5.5);
            pdf.text('Payment', margin + 80, y + 5.5);
            pdf.text('Balance After', margin + 105, y + 5.5);
            pdf.text('‚òê', pageWidth - margin - 5, y + 5.5, { align: 'right' });
            y += 8;
            
            // Calculate running balances for each month
            let runningBalances = {};
            lastCalculatedDebts.forEach(d => runningBalances[d.name] = d.originalBalance);
            
            pdf.setFontSize(7.5);
            pdf.setTextColor(0, 0, 0);
            
            const displayMonths = Math.min(result.months, 60); // Show up to 60 months
            
            for (let monthNum = 1; monthNum <= displayMonths; monthNum++) {
                if (y > 285) {
                    pdf.addPage();
                    y = 15;
                    // Header on new page
                    pdf.setFillColor(0, 82, 136);
                    pdf.rect(margin, y, pageWidth - margin*2, 8, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(8);
                    pdf.text('Month', margin + 2, y + 5.5);
                    pdf.text('Focus On', margin + 25, y + 5.5);
                    pdf.text('Payment', margin + 80, y + 5.5);
                    pdf.text('Balance After', margin + 105, y + 5.5);
                    pdf.text('‚òê', pageWidth - margin - 5, y + 5.5, { align: 'right' });
                    y += 8;
                    pdf.setFontSize(7.5);
                    pdf.setTextColor(0, 0, 0);
                }
                
                const m = result.monthlyBreakdown[monthNum - 1];
                if (!m) break;
                
                // Alternating row colors
                if (monthNum % 2 === 0) {
                    pdf.setFillColor(250, 250, 250);
                    pdf.rect(margin, y, pageWidth - margin*2, 7, 'F');
                }
                
                // Month number
                pdf.text(monthNum.toString(), margin + 3, y + 5);
                
                // Focus debt (truncated)
                const focusDebt = m.target.substring(0, 18);
                pdf.text(focusDebt, margin + 25, y + 5);
                
                // Payment amount
                pdf.text(formatMoney(m.total), margin + 80, y + 5);
                
                // Checkbox
                pdf.setFontSize(10);
                pdf.text('‚òê', pageWidth - margin - 5, y + 5, { align: 'right' });
                pdf.setFontSize(7.5);
                
                // Status indicator
                if (m.status.includes('PAID')) {
                    pdf.setTextColor(46, 125, 50);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('üéâ PAID!', margin + 130, y + 5);
                    pdf.setFont(undefined, 'normal');
                    pdf.setTextColor(0, 0, 0);
                }
                
                y += 7;
            }
            
            if (result.months > 60) {
                pdf.setFontSize(9);
                pdf.setTextColor(100, 100, 100);
                pdf.text(`... ${result.months - 60} more months to debt freedom! Keep going! üí™`, margin, y + 5);
            }
            
            // Footer on all pages
            const pageCount = pdf.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                pdf.setPage(i);
                pdf.setFontSize(7);
                pdf.setTextColor(150, 150, 150);
                pdf.text('Made with DebtSnowballCalculator.com | Page ' + i + ' of ' + pageCount, pageWidth/2, 292, { align: 'center' });
            }
            
            pdf.save('my-debt-free-plan.pdf');
        }

        function exportCalendar() {
            if (!lastResults) return;
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Debt Snowball//EN\n';
            result.timeline.forEach(event => {
                const date = new Date();
                date.setMonth(date.getMonth() + event.month);
                const dateStr = date.toISOString().replace(/[-:]/g, '').split('.')[0];
                icsContent += `BEGIN:VEVENT\nDTSTART;VALUE=DATE:${dateStr.split('T')[0]}\nSUMMARY:üéâ ${event.debt} Paid Off!\nEND:VEVENT\n`;
            });
            icsContent += 'END:VCALENDAR';
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'debt-payoff-dates.ics';
            link.click();
        }

        function generateColoringTracker() {
            if (!lastResults) {
                showError('Calculate your plan first!');
                return;
            }
            
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            
            // Create a new window for the coloring tracker
            const trackerWindow = window.open('', '_blank', 'width=800,height=1000');
            
            let trackerHTML = `
<!DOCTYPE html>
<html>
<head>
    <title>My Debt-Free Coloring Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #005288;
        }
        .header h1 {
            color: #005288;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .goal-date {
            color: #2E7D32;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .debt-thermometer {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 10px;
        }
        .thermometer-title {
            text-align: center;
            font-size: 1.2rem;
            color: #005288;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .thermometer {
            width: 100%;
            height: 60px;
            border: 3px solid #333;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            background: white;
        }
        .thermometer-sections {
            display: flex;
            height: 100%;
        }
        .therm-section {
            flex: 1;
            border-right: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #666;
        }
        .therm-section:last-child { border-right: none; }
        .labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        .instructions p {
            color: #005288;
            font-size: 1rem;
        }
        .debt-blocks {
            margin: 30px 0;
        }
        .debt-blocks h2 {
            color: #005288;
            margin-bottom: 20px;
            text-align: center;
        }
        .debt-block {
            margin-bottom: 25px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        .debt-name {
            font-weight: bold;
            color: #005288;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .debt-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .blocks-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .payoff-block {
            width: 35px;
            height: 35px;
            border: 2px solid #333;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #999;
            background: white;
        }
        .milestone-section {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        .milestone-section h2 {
            color: #005288;
            margin-bottom: 15px;
        }
        .milestone {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .milestone-checkbox {
            width: 25px;
            height: 25px;
            border: 2px solid #333;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .milestone-text {
            flex: 1;
        }
        .milestone-date {
            color: #2E7D32;
            font-weight: bold;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #999;
            font-size: 0.8rem;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        @media print {
            body { padding: 20px; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ My Debt-Free Journey</h1>
        <div class="goal-date">Goal: ${result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
    </div>
    
    <div class="instructions">
        <p>üé® <strong>How to use:</strong> Color in each box as you make payments! Watch your debt disappear!</p>
    </div>
    
    <div class="debt-thermometer">
        <div class="thermometer-title">TOTAL DEBT THERMOMETER</div>
        <div class="thermometer">
            <div class="thermometer-sections">
                <div class="therm-section">Start</div>
                <div class="therm-section">25%</div>
                <div class="therm-section">50%</div>
                <div class="therm-section">75%</div>
                <div class="therm-section">PAID!</div>
            </div>
        </div>
        <div class="labels">
            <span>$${totalDebt.toLocaleString()}</span>
            <span>Color from left to right as you pay!</span>
            <span>$0</span>
        </div>
    </div>
    
    <div class="debt-blocks">
        <h2>üìä Individual Debt Trackers</h2>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">Color one box for each payment you make!</p>
`;

            // Generate blocks for each debt
            result.debts.forEach((debt, index) => {
                const original = lastCalculatedDebts.find(d => d.name === debt.name);
                const numBlocks = Math.min(Math.ceil(original.originalBalance / original.payment), 20);
                const blockValue = original.originalBalance / numBlocks;
                
                trackerHTML += `
        <div class="debt-block">
            <div class="debt-name">${index + 1}. ${debt.name}</div>
            <div class="debt-info">Starting: $${original.originalBalance.toLocaleString()} | Payment: ~$${Math.round(blockValue).toLocaleString()} per box</div>
            <div class="blocks-container">
`;
                
                for (let i = 0; i < numBlocks; i++) {
                    const remaining = original.originalBalance - (i * blockValue);
                    const label = remaining > 0 ? `$${Math.round(remaining/1000)}k` : 'PAID!';
                    trackerHTML += `                <div class="payoff-block">${label}</div>\n`;
                }
                
                trackerHTML += `            </div>
        </div>
`;
            });
            
            // Milestones section
            trackerHTML += `
    </div>
    
    <div class="milestone-section">
        <h2>üèÜ Victory Milestones</h2>
        <p style="color: #666; margin-bottom: 15px;">Check off each milestone as you achieve it!</p>
`;

            // Add debt payoff milestones
            result.timeline.forEach(event => {
                trackerHTML += `
        <div class="milestone">
            <div class="milestone-checkbox"></div>
            <div class="milestone-text">
                <strong>${event.debt}</strong> paid off!
                <div class="milestone-date">${event.date}</div>
            </div>
        </div>
`;
            });
            
            // Add final milestone
            trackerHTML += `
        <div class="milestone">
            <div class="milestone-checkbox"></div>
            <div class="milestone-text">
                <strong>üéâ DEBT FREE!</strong>
                <div class="milestone-date">${result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
            </div>
        </div>
    </div>
    
    <div class="footer no-print">
        <p>Generated by DebtSnowballCalculator.com</p>
        <p style="margin-top: 10px;"><button onclick="window.print()" style="padding: 10px 20px; background: #005288; color: white; border: none; border-radius: 5px; cursor: pointer;">üñ®Ô∏è Print This Page</button></p>
    </div>
</body>
</html>`;
            
            trackerWindow.document.write(trackerHTML);
            trackerWindow.document.close();
        }

        function exportCSV() {
            if (!lastResults) {
                showError('Calculate your plan first!');
                return;
            }
            
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const totalPayment = lastCalculatedDebts.reduce((sum, d) => sum + d.payment, 0) + extraPaymentAmount;
            
            let csv = 'DEBT PAYOFF PLAN\n';
            csv += `Generated,${new Date().toLocaleDateString()}\n`;
            csv += `Method,${currentMethod === 'snowball' ? 'Debt Snowball' : 'Debt Avalanche'}\n`;
            csv += `Total Debt,$${totalDebt}\n`;
            csv += `Monthly Payment,$${totalPayment}\n`;
            csv += `Debt-Free Date,${result.finalDate.toLocaleDateString()}\n`;
            csv += `Total Interest,$${result.totalInterest.toFixed(2)}\n`;
            csv += `Months to Payoff,${result.months}\n\n`;
            
            // Debt Summary
            csv += 'DEBT SUMMARY\n';
            csv += 'Name,Original Balance,Interest Rate,Min Payment,Payoff Month\n';
            result.debts.forEach((debt, index) => {
                const original = lastCalculatedDebts.find(d => d.name === debt.name);
                csv += `"${debt.name}",${original.originalBalance},${original.rate}%,${original.payment},${debt.paidOff || 'N/A'}\n`;
            });
            csv += '\n';
            
            // Monthly Schedule
            csv += 'MONTHLY PAYMENT SCHEDULE\n';
            csv += 'Month,Date,Focus Debt,Payment Amount,Extra Payment,Total Paid,Status\n';
            
            result.monthlyBreakdown.forEach(m => {
                const date = new Date();
                date.setMonth(date.getMonth() + m.month);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                csv += `${m.month},${dateStr},"${m.target}",${m.minimum},${m.extra},${m.total},"${m.status}"\n`;
            });
            
            // Milestones
            csv += '\nMILESTONES\n';
            csv += 'Month,Date,Debt Paid Off,Amount\n';
            result.timeline.forEach(event => {
                const original = lastCalculatedDebts.find(d => d.name === event.debt);
                csv += `${event.month},${event.date},"${event.debt}",${original ? original.originalBalance : 0}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `debt-payoff-plan-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function showShareModal() { document.getElementById('shareModal').classList.add('show'); }
        
        async function downloadImage() {
            const element = document.getElementById('shareContent');
            const canvas = await html2canvas(element, { scale: 2, backgroundColor: '#ffffff' });
            const link = document.createElement('a');
            link.download = 'my-debt-free-journey.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function shareTwitter() {
            if (!lastResults) return;
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const text = `I'm on track to be debt-free by ${result.finalDate.toLocaleDateString('en-US', {month:'long', year:'numeric'})}! Working to pay off ${formatMoney(totalDebt)} using the ${currentMethod} method. üí™`;
            window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(text), '_blank');
        }

        function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }
    </script>
</body>
</html>
