<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Snowball Calculator | Dave Ramsey Method</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --ramsey-blue: #005288;
            --ramsey-blue-dark: #003d66;
            --ramsey-blue-light: #0077B6;
            --ramsey-green: #2E7D32;
            --ramsey-green-light: #4CAF50;
            --ramsey-red: #D32F2F;
            --ramsey-orange: #F57C00;
            --ramsey-gray: #616161;
            --ramsey-gray-light: #F5F5F5;
            --ramsey-gray-dark: #212121;
            --white: #FFFFFF;
            --gold: #FFD700;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--ramsey-gray-light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: var(--ramsey-gray-dark);
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: var(--ramsey-blue);
            color: var(--white);
            padding: 40px 30px;
            text-align: center;
            border-bottom: 5px solid var(--ramsey-green);
        }
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 500px;
            margin: 0 auto;
        }
        .badges-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .earned-badge {
            background: linear-gradient(135deg, var(--gold) 0%, #FFA000 100%);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: badgePop 0.5s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        @keyframes badgePop {
            0% { transform: scale(0) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0); }
        }
        .content { padding: 30px; }
        .countdown-section {
            background: linear-gradient(135deg, var(--ramsey-blue) 0%, var(--ramsey-blue-dark) 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            display: none;
        }
        .countdown-section.show { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .countdown-title { font-size: 1.3rem; margin-bottom: 20px; opacity: 0.9; }
        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .countdown-unit {
            background: rgba(255,255,255,0.15);
            padding: 15px 25px;
            border-radius: 8px;
            min-width: 80px;
        }
        .countdown-value { font-size: 2.5rem; font-weight: 700; }
        .countdown-label { font-size: 0.9rem; opacity: 0.8; text-transform: uppercase; }
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; }
        .method-toggle {
            background: var(--ramsey-gray-light);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid var(--ramsey-blue);
        }
        .method-toggle h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .toggle-wrapper {
            display: flex;
            background: var(--white);
            border-radius: 6px;
            padding: 4px;
            gap: 4px;
            border: 2px solid #e0e0e0;
        }
        .toggle-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--ramsey-gray);
            font-size: 0.95rem;
        }
        .toggle-btn[aria-pressed="true"] {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .method-desc {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--ramsey-blue);
            font-size: 0.95rem;
            color: var(--ramsey-gray);
            line-height: 1.7;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .whatif-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px solid var(--ramsey-orange);
        }
        .whatif-section h3 {
            color: #e65100;
            margin-bottom: 15px;
        }
        .whatif-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .whatif-btn {
            background: var(--white);
            border: 2px solid var(--ramsey-orange);
            color: #e65100;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .whatif-btn:hover {
            background: var(--ramsey-orange);
            color: white;
        }
        .whatif-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            display: none;
        }
        .whatif-result.show { display: block; }
        .extra-payment-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px solid var(--ramsey-green);
        }
        .extra-payment-section h3 {
            color: var(--ramsey-green);
            margin-bottom: 10px;
        }
        .slider-container { margin: 20px 0; }
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--ramsey-gray);
        }
        .slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: #c8e6c9;
            outline: none;
            -webkit-appearance: none;
            margin: 15px 0;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--ramsey-green);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(46, 125, 50, 0.4);
            border: 3px solid var(--white);
            margin-top: -18px;
        }
        .slider::-moz-range-thumb {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--ramsey-green);
            cursor: pointer;
            border: 3px solid var(--white);
            box-shadow: 0 2px 8px rgba(46, 125, 50, 0.4);
        }
        .extra-amount {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--ramsey-green);
            margin: 20px 0 10px;
        }
        .time-saved {
            text-align: center;
            color: #1b5e20;
            font-weight: 600;
            font-size: 1rem;
            min-height: 24px;
        }
        .input-section h2 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
        }
        .debt-form {
            background: var(--ramsey-gray-light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
        }
        .form-row label {
            font-size: 0.85rem;
            color: var(--ramsey-gray);
            margin-bottom: 6px;
            display: block;
            font-weight: 500;
        }
        .form-row input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .form-row input:focus {
            outline: none;
            border-color: var(--ramsey-blue);
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .btn-primary {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .btn-primary:hover { background: var(--ramsey-blue-dark); }
        .btn-secondary {
            background: var(--ramsey-gray-light);
            color: var(--ramsey-gray-dark);
            border: 2px solid #e0e0e0;
        }
        .btn-danger {
            background: var(--ramsey-red);
            color: var(--white);
            padding: 12px 16px;
        }
        .btn-success {
            background: var(--ramsey-green);
            color: var(--white);
        }
        .btn-outline {
            background: var(--white);
            border: 2px solid var(--ramsey-blue);
            color: var(--ramsey-blue);
        }
        .btn-outline:hover {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        .comparison-card {
            background: var(--white);
            border: 3px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }
        .comparison-card.winner {
            border-color: var(--ramsey-green);
            background: #e8f5e9;
            transform: scale(1.02);
        }
        .comparison-card h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
        }
        .comparison-stat {
            font-size: 2rem;
            font-weight: 700;
            color: var(--ramsey-blue);
            margin: 10px 0;
        }
        .comparison-card.winner .comparison-stat {
            color: var(--ramsey-green);
        }
        .winner-badge {
            display: inline-block;
            background: var(--ramsey-green);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 10px;
            text-transform: uppercase;
        }
        .results { display: none; }
        .results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: var(--ramsey-blue);
            color: var(--white);
            padding: 25px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .summary-card .amount {
            font-size: 2rem;
            font-weight: 700;
        }
        .monthly-breakdown {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .breakdown-table th {
            background: var(--ramsey-blue);
            color: white;
            padding: 12px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        .breakdown-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        .breakdown-table tr:hover { background: var(--ramsey-gray-light); }
        .breakdown-table .paid-off {
            background: #e8f5e9;
            font-weight: 600;
        }
        .debt-list h2 {
            color: var(--ramsey-blue);
            margin-bottom: 20px;
            font-weight: 600;
        }
        .debt-item {
            background: var(--white);
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        .debt-item.paid {
            border-color: var(--ramsey-green);
            background: #e8f5e9;
        }
        .debt-item.current {
            border-color: var(--ramsey-blue);
            box-shadow: 0 0 0 3px rgba(0, 82, 136, 0.1);
        }
        .debt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .debt-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .debt-balance {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--ramsey-red);
        }
        .debt-item.paid .debt-balance {
            color: var(--ramsey-green);
        }
        .progress-bar {
            height: 28px;
            background: #e0e0e0;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--ramsey-red) 0%, #ff9800 50%, var(--ramsey-green) 100%);
            border-radius: 14px;
            transition: width 1s ease;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            color: var(--ramsey-gray-dark);
            font-size: 0.9rem;
        }
        .debt-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        .detail-item { text-align: center; }
        .detail-label {
            font-size: 0.8rem;
            color: var(--ramsey-gray);
            margin-bottom: 5px;
        }
        .detail-value {
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge-current {
            background: var(--ramsey-blue);
            color: var(--white);
        }
        .badge-paid {
            background: var(--ramsey-green);
            color: var(--white);
        }
        .badge-upcoming {
            background: #e0e0e0;
            color: var(--ramsey-gray);
        }
        .timeline {
            margin-top: 30px;
            padding: 25px;
            background: var(--ramsey-gray-light);
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .timeline h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
            font-weight: 600;
        }
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ddd;
        }
        .timeline-date {
            width: 120px;
            font-weight: 700;
            color: var(--ramsey-blue);
        }
        .celebration {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 8px;
            margin-top: 30px;
            display: none;
            border: 3px solid var(--ramsey-green);
        }
        .celebration.show {
            display: block;
            animation: celebrate 0.5s ease;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }
        .celebration h2 {
            color: var(--ramsey-green);
            font-size: 2.2rem;
            margin-bottom: 15px;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .share-card {
            background: var(--white);
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
            border: 3px solid var(--ramsey-green);
        }
        .share-card h2 {
            color: var(--ramsey-blue);
            margin-bottom: 20px;
        }
        .share-stat {
            font-size: 3rem;
            font-weight: 700;
            color: var(--ramsey-green);
            margin: 15px 0;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .loading.show { display: block; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: var(--ramsey-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-message {
            background: #ffebee;
            color: var(--ramsey-red);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid var(--ramsey-red);
            display: none;
        }
        .error-message.show { display: block; }
        .affiliate-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px solid var(--ramsey-blue-light);
        }
        .affiliate-section h3 {
            color: var(--ramsey-blue);
            margin-bottom: 15px;
        }
        .affiliate-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .affiliate-link {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--ramsey-gray-dark);
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }
        .affiliate-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: var(--ramsey-blue);
        }
        .affiliate-link strong {
            color: var(--ramsey-blue);
            display: block;
            margin-bottom: 5px;
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { border-radius: 0; }
            .header { padding: 25px 15px; }
            .header h1 { font-size: 1.6rem; }
            .header p { font-size: 1rem; }
            .content { padding: 15px; }
            .form-row { 
                grid-template-columns: 1fr; 
                gap: 8px;
            }
            .form-row label { margin-bottom: 4px; }
            .form-row input { padding: 14px; font-size: 16px; }
            .action-buttons { flex-direction: column; }
            .action-buttons .btn { width: 100%; }
            .comparison-section { grid-template-columns: 1fr; }
            .summary-cards { grid-template-columns: 1fr 1fr; }
            .summary-card { padding: 15px; }
            .summary-card .amount { font-size: 1.5rem; }
            .comparison-card { padding: 20px 15px; }
            .comparison-stat { font-size: 1.5rem; }
            .toggle-wrapper { flex-direction: column; }
            .toggle-btn { padding: 12px; }
            .whatif-buttons { flex-direction: column; }
            .whatif-btn { width: 100%; }
            .countdown-timer { gap: 8px; }
            .countdown-unit {
                padding: 10px 12px;
                min-width: 50px;
            }
            .countdown-value { font-size: 1.5rem; }
            .countdown-label { font-size: 0.75rem; }
            .debt-details { grid-template-columns: 1fr; gap: 8px; }
            .monthly-breakdown { max-height: 300px; }
            .breakdown-table { font-size: 0.8rem; }
            .breakdown-table th, .breakdown-table td { padding: 8px; }
            .quick-actions { flex-direction: column; }
            .btn-small { width: 100%; }
            .affiliate-links { grid-template-columns: 1fr; }
            .modal { padding: 20px; width: 95%; }
            .share-card { padding: 25px 20px; }
        }
        @media (max-width: 480px) {
            .summary-cards { grid-template-columns: 1fr; }
            .extra-amount { font-size: 2rem; }
            .debt-name { font-size: 1rem; }
            .debt-balance { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Debt Snowball Calculator</h1>
            <p>Calculate your path to debt freedom using Dave Ramsey's proven method</p>
            <div class="badges-display" id="earnedBadges"></div>
        </div>

        <div class="content">
            <div id="errorMessage" class="error-message"></div>

            <div class="quick-actions">
                <button class="btn btn-secondary btn-small" onclick="loadExample()">üìã Load Example</button>
                <button class="btn btn-secondary btn-small" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>

            <div class="method-toggle">
                <h3>Choose Your Strategy</h3>
                <div class="toggle-wrapper">
                    <button class="toggle-btn" onclick="setMethod('snowball')" id="snowballBtn" aria-pressed="false">üèîÔ∏è Debt Snowball</button>
                    <button class="toggle-btn" onclick="setMethod('avalanche')" id="avalancheBtn" aria-pressed="false">üèîÔ∏è Debt Avalanche</button>
                </div>
                <p class="method-desc" id="methodDesc"></p>
            </div>

            <div class="whatif-section">
                <h3>ü§î What If Scenarios</h3>
                <div class="whatif-buttons">
                    <button class="whatif-btn" onclick="whatIfExtra(50)">+$50/month</button>
                    <button class="whatif-btn" onclick="whatIfExtra(200)">+$200/month</button>
                    <button class="whatif-btn" onclick="whatIfBonus(1000)">+$1,000 bonus</button>
                    <button class="whatif-btn" onclick="whatIfBonus(5000)">+$5,000 bonus</button>
                </div>
                <div id="whatifResult" class="whatif-result"></div>
            </div>

            <div class="extra-payment-section">
                <h3>‚ö° Extra Monthly Payment</h3>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>$0</span>
                        <span>$500</span>
                        <span>$1,000</span>
                        <span>$2,000+</span>
                    </div>
                    <input type="range" class="slider" id="extraPayment" min="0" max="2000" step="50" value="0" oninput="updateExtraPayment(this.value)" aria-label="Extra monthly payment amount">
                </div>
                <div class="extra-amount" id="extraAmount">$0</div>
                <div class="time-saved" id="timeSaved"></div>
            </div>

            <div class="input-section">
                <h2>Enter Your Debts</h2>
                <div id="debtInputs"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="addDebtInput()">+ Add Another Debt</button>
                    <button class="btn btn-primary" onclick="calculateSnowball()">üí™ Calculate My Payoff</button>
                </div>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Crunching the numbers...</p>
            </div>

            <div id="results" class="results">
                <div class="comparison-section" id="comparisonSection" style="display:none;">
                    <div class="comparison-card" id="snowballCard">
                        <h3>üèîÔ∏è Snowball</h3>
                        <div class="comparison-stat" id="snowballTime">0 months</div>
                        <p>Payoff Time</p>
                        <div class="comparison-stat" id="snowballInterest">$0</div>
                        <p>Total Interest</p>
                    </div>
                    <div class="comparison-card" id="avalancheCard">
                        <h3>üèîÔ∏è Avalanche</h3>
                        <div class="comparison-stat" id="avalancheTime">0 months</div>
                        <p>Payoff Time</p>
                        <div class="comparison-stat" id="avalancheInterest">$0</div>
                        <p>Total Interest</p>
                    </div>
                </div>

                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Debt</h3>
                        <div class="amount" id="totalDebt">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Monthly Payments</h3>
                        <div class="amount" id="totalPayments">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3>Debt-Free Date</h3>
                        <div class="amount" id="debtFreeDate">-</div>
                    </div>
                    <div class="summary-card">
                        <h3>Interest Saved</h3>
                        <div class="amount" id="interestSaved">$0</div>
                    </div>
                </div>

                <div id="countdownSection" class="countdown-section">
                    <div class="countdown-title">‚è∞ Time Until You're Debt Free!</div>
                    <div class="countdown-timer" id="countdownTimer"></div>
                </div>

                <div class="timeline">
                    <h3>üìÖ Month-by-Month Breakdown</h3>
                    <div class="monthly-breakdown">
                        <table class="breakdown-table" id="breakdownTable">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Debt Target</th>
                                    <th>Minimum</th>
                                    <th>Extra</th>
                                    <th>Total Paid</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="breakdownBody"></tbody>
                        </table>
                    </div>
                </div>

                <div style="margin: 30px 0;">
                    <h3 style="color: var(--ramsey-blue); margin-bottom: 15px;">üì§ Export & Share</h3>
                    <div class="action-buttons">
                        <button class="btn btn-outline" onclick="printPlan()">üñ®Ô∏è Print</button>
                        <button class="btn btn-outline" onclick="generateColoringTracker()">üé® Coloring Tracker</button>
                        <button class="btn btn-outline" onclick="exportCSV()">üìä Export CSV</button>
                        <button class="btn btn-outline" onclick="exportCalendar()">üìÖ Calendar</button>
                        <button class="btn btn-success" onclick="showShareModal()">üì∏ Share</button>
                    </div>
                </div>

                <div class="debt-list">
                    <h2>üìä Your Debt Payoff Order</h2>
                    <div id="debtList"></div>
                </div>

                <div id="celebration" class="celebration">
                    <h2>üéâ You're Debt Free!</h2>
                    <p id="celebrationMessage"></p>
                    <div id="earnedBadgesCelebration" style="margin-top: 20px;"></div>
                </div>

                <div class="affiliate-section">
                    <h3>üìö Continue Your Journey</h3>
                    <div class="affiliate-links">
                        <a href="https://www.ramseysolutions.com/store/financial-peace-university" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üìñ Financial Peace University</strong>
                            Dave Ramsey's complete money course
                        </a>
                        <a href="https://www.ramseysolutions.com/store/the-total-money-makeover" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üìö The Total Money Makeover</strong>
                            The book that started it all
                        </a>
                        <a href="https://www.ramseysolutions.com/store/everydollar" target="_blank" rel="noopener noreferrer" class="affiliate-link">
                            <strong>üí∞ EveryDollar App</strong>
                            Track your budget and debt progress
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="shareModal" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
        <div class="modal" style="max-width: 700px;">
            <div id="shareContent">
                <div class="share-card">
                    <h2 id="shareTitle">üéØ My Debt-Free Journey</h2>
                    <div class="share-stat" id="shareDebtFreeDate">-</div>
                    <p style="font-size: 1.3rem; color: #616161;">Debt-Free Date</p>
                    <div id="shareBadges" style="margin: 20px 0;"></div>
                    <div id="shareMessage"></div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="downloadImage()">üíæ Download</button>
                <button class="btn btn-primary" onclick="shareTwitter()">üê¶ Tweet</button>
                <button class="btn btn-secondary" onclick="closeModal('shareModal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let debtCount = 0;
        let currentMethod = 'snowball';
        let extraPaymentAmount = 0;
        let lastCalculatedDebts = [];
        let lastResults = null;
        let earnedBadges = JSON.parse(localStorage.getItem('debtBadges') || '[]');
        let countdownInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setMethod('snowball');
            addDebtInput();
            loadSavedData();
            displayBadges();
        });

        // Safe DOM helpers (no XSS)
        function createElement(tag, options = {}) {
            const el = document.createElement(tag);
            if (options.className) el.className = options.className;
            if (options.textContent) el.textContent = options.textContent;
            if (options.id) el.id = options.id;
            return el;
        }

        function clearElement(element) {
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
        }

        function loadSavedData() {
            const saved = localStorage.getItem('debtSnowballData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.debts?.length > 0) {
                        const container = document.getElementById('debtInputs');
                        clearElement(container);
                        debtCount = 0;
                        data.debts.forEach(debt => {
                            addDebtInput();
                            const forms = document.querySelectorAll('.debt-form');
                            const lastForm = forms[forms.length - 1];
                            const inputs = lastForm.querySelectorAll('input');
                            inputs[0].value = debt.name || '';
                            inputs[1].value = debt.balance || '';
                            inputs[2].value = debt.payment || '';
                            inputs[3].value = debt.rate || '';
                        });
                    }
                    if (data.extraPayment !== undefined) {
                        extraPaymentAmount = data.extraPayment;
                        document.getElementById('extraPayment').value = extraPaymentAmount;
                        document.getElementById('extraAmount').textContent = '$' + extraPaymentAmount.toLocaleString();
                    }
                    if (data.method) setMethod(data.method);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        function saveData() {
            const debts = [];
            document.querySelectorAll('.debt-form').forEach(form => {
                const inputs = form.querySelectorAll('input');
                debts.push({
                    name: inputs[0].value || '',
                    balance: inputs[1].value || '',
                    payment: inputs[2].value || '',
                    rate: inputs[3].value || ''
                });
            });
            localStorage.setItem('debtSnowballData', JSON.stringify({
                debts, extraPayment: extraPaymentAmount, method: currentMethod
            }));
        }

        function loadExample() {
            const container = document.getElementById('debtInputs');
            clearElement(container);
            debtCount = 0;
            
            // Large pool of realistic example debts
            const debtPool = [
                { name: 'Chase Sapphire Card', balance: 5200, payment: 120, rate: 22.99 },
                { name: 'Capital One Card', balance: 2800, payment: 75, rate: 19.99 },
                { name: 'Discover It Card', balance: 1500, payment: 45, rate: 18.99 },
                { name: 'Amex Gold Card', balance: 8500, payment: 200, rate: 24.99 },
                { name: 'Bank of America Card', balance: 3200, payment: 90, rate: 20.99 },
                { name: 'Citi Double Cash', balance: 4100, payment: 100, rate: 19.99 },
                { name: 'Wells Fargo Card', balance: 1800, payment: 55, rate: 21.99 },
                { name: 'US Bank Card', balance: 2300, payment: 65, rate: 18.99 },
                { name: 'Honda Civic Loan', balance: 14500, payment: 325, rate: 5.49 },
                { name: 'Toyota Camry Loan', balance: 18900, payment: 395, rate: 4.99 },
                { name: 'Ford F-150 Loan', balance: 24500, payment: 485, rate: 6.49 },
                { name: 'BMW 3 Series Loan', balance: 32000, payment: 595, rate: 5.99 },
                { name: 'Tesla Model 3 Loan', balance: 28500, payment: 525, rate: 5.49 },
                { name: 'Federal Student Loans', balance: 22000, payment: 280, rate: 4.5 },
                { name: 'Private Student Loans', balance: 15500, payment: 195, rate: 6.8 },
                { name: 'Sallie Mae Loan', balance: 18000, payment: 220, rate: 7.2 },
                { name: 'SoFi Personal Loan', balance: 12000, payment: 350, rate: 11.99 },
                { name: 'Marcus Personal Loan', balance: 8500, payment: 275, rate: 10.99 },
                { name: 'PayPal Credit', balance: 2200, payment: 65, rate: 23.99 },
                { name: 'Affirm Payment Plan', balance: 1800, payment: 150, rate: 15.99 },
                { name: 'Klarna Balance', balance: 950, payment: 85, rate: 19.99 },
                { name: 'Afterpay Balance', balance: 650, payment: 65, rate: 0 },
                { name: 'Medical Debt - Hospital', balance: 4500, payment: 150, rate: 0 },
                { name: 'Dentist Payment Plan', balance: 3200, payment: 135, rate: 8.99 },
                { name: 'Vet Care Loan', balance: 2800, payment: 120, rate: 12.99 },
                { name: 'Home Depot Card', balance: 3500, payment: 100, rate: 17.99 },
                { name: "Lowe's Card", balance: 2800, payment: 85, rate: 17.99 },
                { name: 'Amazon Store Card', balance: 1800, payment: 60, rate: 25.99 },
                { name: 'Best Buy Card', balance: 2200, payment: 75, rate: 23.99 },
                { name: 'Apple Card', balance: 3200, payment: 95, rate: 19.99 }
            ];
            
            // Randomly select 3-4 debts
            const numDebts = Math.floor(Math.random() * 2) + 3; // 3 or 4
            const shuffled = [...debtPool].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, numDebts);
            
            selected.forEach(debt => {
                addDebtInput();
                const forms = document.querySelectorAll('.debt-form');
                const lastForm = forms[forms.length - 1];
                const inputs = lastForm.querySelectorAll('input');
                inputs[0].value = debt.name;
                inputs[1].value = debt.balance;
                inputs[2].value = debt.payment;
                inputs[3].value = debt.rate;
            });
            saveData();
            awardBadge('explorer');
        }

        function clearAll() {
            if (confirm('Clear all debts?')) {
                // Clear debt inputs
                const container = document.getElementById('debtInputs');
                clearElement(container);
                debtCount = 0;
                addDebtInput();
                
                // Hide results
                document.getElementById('results').classList.remove('show');
                document.getElementById('comparisonSection').style.display = 'none';
                document.getElementById('celebration').classList.remove('show');
                document.getElementById('countdownSection').classList.remove('show');
                
                // Clear breakdown table
                clearElement(document.getElementById('breakdownBody'));
                clearElement(document.getElementById('debtList'));
                
                // Reset extra payment slider
                extraPaymentAmount = 0;
                document.getElementById('extraPayment').value = 0;
                document.getElementById('extraAmount').textContent = '$0';
                document.getElementById('timeSaved').textContent = '';
                
                // Clear what-if results
                document.getElementById('whatifResult').classList.remove('show');
                clearElement(document.getElementById('whatifResult'));
                
                // Reset data
                lastCalculatedDebts = [];
                lastResults = null;
                if (countdownInterval) clearInterval(countdownInterval);
                
                saveData();
                
                // Show confirmation
                showToast('All cleared! Start fresh üí™');
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function awardBadge(badgeId) {
            const badges = {
                explorer: { icon: 'üîç', name: 'Explorer', desc: 'Loaded example data' },
                calculator: { icon: 'üßÆ', name: 'Calculator', desc: 'Ran first calculation' },
                snowball: { icon: 'üèîÔ∏è', name: 'Snowball Starter', desc: 'Used snowball method' },
                avalanche: { icon: '‚õ∞Ô∏è', name: 'Avalanche Pro', desc: 'Used avalanche method' },
                extramiler: { icon: '‚ö°', name: 'Extra Miler', desc: 'Added extra payments' },
                debtfree: { icon: 'üéâ', name: 'Debt Free Dreamer', desc: 'Calculated debt-free date' },
                firstdebt: { icon: 'üéØ', name: 'First Blood', desc: 'Paid off first debt in simulation' },
                halfway: { icon: 'üìà', name: 'Halfway Hero', desc: '50% to debt free' },
                saver: { icon: 'üí∞', name: 'Super Saver', desc: 'Saved $1000+ in interest' }
            };
            if (!earnedBadges.includes(badgeId) && badges[badgeId]) {
                earnedBadges.push(badgeId);
                localStorage.setItem('debtBadges', JSON.stringify(earnedBadges));
                displayBadges();
            }
        }

        function displayBadges() {
            const badges = {
                explorer: { icon: 'üîç', name: 'Explorer' },
                calculator: { icon: 'üßÆ', name: 'Calculator' },
                snowball: { icon: 'üèîÔ∏è', name: 'Snowball' },
                avalanche: { icon: '‚õ∞Ô∏è', name: 'Avalanche' },
                extramiler: { icon: '‚ö°', name: 'Extra Miler' },
                debtfree: { icon: 'üéâ', name: 'Debt Free' },
                firstdebt: { icon: 'üéØ', name: 'First Win' },
                halfway: { icon: 'üìà', name: 'Halfway' },
                saver: { icon: 'üí∞', name: 'Super Saver' }
            };
            const container = document.getElementById('earnedBadges');
            clearElement(container);
            earnedBadges.forEach(id => {
                const badge = badges[id];
                if (!badge) return;
                const badgeEl = createElement('div', { className: 'earned-badge' });
                badgeEl.textContent = badge.icon + ' ' + badge.name;
                container.appendChild(badgeEl);
            });
        }

        function startCountdown(targetDate) {
            if (countdownInterval) clearInterval(countdownInterval);
            const section = document.getElementById('countdownSection');
            section.classList.add('show');
            
            function update() {
                const now = new Date();
                const diff = targetDate - now;
                const timer = document.getElementById('countdownTimer');
                clearElement(timer);
                
                if (diff <= 0) {
                    const unit = createElement('div', { className: 'countdown-unit' });
                    const value = createElement('div', { className: 'countdown-value', textContent: 'üéâ' });
                    const label = createElement('div', { className: 'countdown-label', textContent: 'DEBT FREE!' });
                    unit.append(value, label);
                    timer.appendChild(unit);
                    return;
                }
                
                const years = Math.floor(diff / (365.25 * 24 * 60 * 60 * 1000));
                const months = Math.floor((diff % (365.25 * 24 * 60 * 60 * 1000)) / (30.44 * 24 * 60 * 60 * 1000));
                const days = Math.floor((diff % (30.44 * 24 * 60 * 60 * 1000)) / (24 * 60 * 60 * 1000));
                const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                
                if (years > 0) {
                    const unit = createElement('div', { className: 'countdown-unit' });
                    unit.append(
                        createElement('div', { className: 'countdown-value', textContent: years }),
                        createElement('div', { className: 'countdown-label', textContent: 'Years' })
                    );
                    timer.appendChild(unit);
                }
                if (months > 0) {
                    const unit = createElement('div', { className: 'countdown-unit' });
                    unit.append(
                        createElement('div', { className: 'countdown-value', textContent: months }),
                        createElement('div', { className: 'countdown-label', textContent: 'Months' })
                    );
                    timer.appendChild(unit);
                }
                const daysUnit = createElement('div', { className: 'countdown-unit' });
                daysUnit.append(
                    createElement('div', { className: 'countdown-value', textContent: days }),
                    createElement('div', { className: 'countdown-label', textContent: 'Days' })
                );
                timer.appendChild(daysUnit);
                
                const hoursUnit = createElement('div', { className: 'countdown-unit' });
                hoursUnit.append(
                    createElement('div', { className: 'countdown-value', textContent: hours }),
                    createElement('div', { className: 'countdown-label', textContent: 'Hours' })
                );
                timer.appendChild(hoursUnit);
            }
            update();
            countdownInterval = setInterval(update, 60000);
        }

        function whatIfExtra(amount) {
            if (lastCalculatedDebts.length === 0) {
                showError('Calculate your plan first!');
                return;
            }
            const baseResult = calculatePayoff(JSON.parse(JSON.stringify(lastCalculatedDebts)), currentMethod, 0);
            const extraResult = calculatePayoff(JSON.parse(JSON.stringify(lastCalculatedDebts)), currentMethod, amount);
            const monthsSaved = baseResult.months - extraResult.months;
            const interestSaved = baseResult.totalInterest - extraResult.totalInterest;
            
            const resultEl = document.getElementById('whatifResult');
            clearElement(resultEl);
            const line1 = createElement('strong');
            line1.textContent = `What if you pay $${amount} extra per month?`;
            const line2 = createElement('strong');
            line2.textContent = `${monthsSaved} months sooner`;
            const line3 = createElement('strong');
            line3.textContent = `$${Math.round(interestSaved).toLocaleString()}`;
            resultEl.append(
                line1,
                document.createElement('br'),
                document.createTextNode("üéâ You'll be debt-free "),
                line2,
                document.createTextNode('!'),
                document.createElement('br'),
                document.createTextNode('üí∞ And save '),
                line3,
                document.createTextNode(' in interest!')
            );
            resultEl.classList.add('show');
        }

        function whatIfBonus(amount) {
            if (lastCalculatedDebts.length === 0) {
                showError('Calculate your plan first!');
                return;
            }
            const debts = JSON.parse(JSON.stringify(lastCalculatedDebts));
            const baseResult = calculatePayoff(debts, currentMethod, extraPaymentAmount);
            debts[0].balance = Math.max(0, debts[0].balance - amount);
            const bonusResult = calculatePayoff(debts, currentMethod, extraPaymentAmount);
            const monthsSaved = baseResult.months - bonusResult.months;
            const interestSaved = baseResult.totalInterest - bonusResult.totalInterest;
            
            const resultEl = document.getElementById('whatifResult');
            clearElement(resultEl);
            const line1 = createElement('strong');
            line1.textContent = `What if you apply a $${amount.toLocaleString()} bonus?`;
            const line2 = createElement('strong');
            line2.textContent = `${monthsSaved} month${monthsSaved !== 1 ? 's' : ''} sooner`;
            const line3 = createElement('strong');
            line3.textContent = `$${Math.round(interestSaved).toLocaleString()}`;
            resultEl.append(
                line1,
                document.createElement('br'),
                document.createTextNode("üéâ You'll be debt-free "),
                line2,
                document.createTextNode('!'),
                document.createElement('br'),
                document.createTextNode('üí∞ And save '),
                line3,
                document.createTextNode(' in interest!')
            );
            resultEl.classList.add('show');
        }

        function setMethod(method) {
            currentMethod = method;
            const snowballBtn = document.getElementById('snowballBtn');
            const avalancheBtn = document.getElementById('avalancheBtn');
            snowballBtn.classList.toggle('active', method === 'snowball');
            avalancheBtn.classList.toggle('active', method === 'avalanche');
            snowballBtn.setAttribute('aria-pressed', method === 'snowball');
            avalancheBtn.setAttribute('aria-pressed', method === 'avalanche');
            
            const descEl = document.getElementById('methodDesc');
            clearElement(descEl);
            
            // Create visually distinct description
            const icon = createElement('span', { textContent: method === 'snowball' ? 'üèîÔ∏è ' : '‚õ∞Ô∏è ' });
            icon.style.fontSize = '1.2rem';
            icon.style.marginRight = '5px';
            
            const strong = createElement('strong');
            strong.textContent = method === 'snowball' ? 'Debt Snowball: ' : 'Debt Avalanche: ';
            strong.style.color = 'var(--ramsey-blue)';
            
            const restText = method === 'snowball'
                ? 'Pay smallest debts first for quick wins and motivation. Great for staying motivated!'
                : 'Pay highest interest debts first to save the most money. Best for math-minded people!';
            
            descEl.append(icon, strong, document.createTextNode(restText));
            
            // Show toast notification
            showToast(`Switched to ${method === 'snowball' ? 'Debt Snowball' : 'Debt Avalanche'} method`);
            
            saveData();
            
            // Recalculate if we have data
            if (lastCalculatedDebts.length > 0) {
                calculateSnowball();
                showToast(`Recalculated with ${method === 'snowball' ? 'Snowball' : 'Avalanche'} method!`);
            }
        }
        
        function showToast(message) {
            // Remove existing toast
            const existing = document.querySelector('.toast-notification');
            if (existing) existing.remove();
            
            const toast = createElement('div', { className: 'toast-notification', textContent: message });
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--ramsey-blue);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideUp 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        function addDebtInput() {
            debtCount++;
            const container = document.getElementById('debtInputs');
            const newDebt = createElement('div', { className: 'debt-form' });
            const formRow = createElement('div', { className: 'form-row' });
            
            const createField = (labelText, type, placeholder, min, step, inputId) => {
                const wrapper = createElement('div');
                const label = createElement('label');
                label.textContent = labelText;
                const input = document.createElement('input');
                input.type = type;
                input.placeholder = placeholder;
                if (min !== undefined) input.min = min;
                if (step !== undefined) input.step = step;
                input.id = inputId;
                label.htmlFor = inputId;
                wrapper.append(label, input);
                return wrapper;
            };
            
            formRow.append(
                createField('Debt Name', 'text', `e.g., Credit Card ${debtCount}`, undefined, undefined, `debt-name-${debtCount}`),
                createField('Balance ($)', 'number', '0', 0, 0.01, `debt-balance-${debtCount}`),
                createField('Min Payment ($)', 'number', '0', 0, 0.01, `debt-payment-${debtCount}`),
                createField('Interest Rate (%)', 'number', '0', 0, 0.01, `debt-rate-${debtCount}`)
            );
            
            const removeButton = createElement('button', { className: 'btn btn-danger' });
            removeButton.type = 'button';
            removeButton.setAttribute('aria-label', 'Remove debt');
            removeButton.textContent = '‚úï';
            removeButton.addEventListener('click', () => removeDebt(removeButton));
            formRow.appendChild(removeButton);
            
            newDebt.appendChild(formRow);
            container.appendChild(newDebt);
            updateRemoveButtons();
        }

        function removeDebt(btn) {
            btn.closest('.debt-form').remove();
            updateRemoveButtons();
            saveData();
        }

        function updateRemoveButtons() {
            const forms = document.querySelectorAll('.debt-form');
            const showRemove = forms.length > 1;
            forms.forEach(form => {
                const btn = form.querySelector('.btn-danger');
                if (btn) btn.style.display = showRemove ? 'inline-block' : 'none';
            });
        }

        function updateExtraPayment(value) {
            extraPaymentAmount = parseInt(value) || 0;
            document.getElementById('extraAmount').textContent = '$' + extraPaymentAmount.toLocaleString();
            saveData();
            if (lastCalculatedDebts.length > 0) calculateSnowball();
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        function validateDebts(debts) {
            if (debts.length === 0) return 'Please enter at least one debt.';
            for (let debt of debts) {
                if (debt.balance <= 0) return `Balance for "${debt.name}" must be greater than 0.`;
                if (debt.payment <= 0) return `Minimum payment for "${debt.name}" must be greater than 0.`;
                if (debt.payment >= debt.balance) return `Minimum payment for "${debt.name}" should be less than the balance.`;
            }
            return null;
        }

        function calculateSnowball() {
            const debts = [];
            document.querySelectorAll('.debt-form').forEach((form, index) => {
                const inputs = form.querySelectorAll('input');
                const name = (inputs[0].value || `Debt ${index + 1}`).trim();
                const balance = parseFloat(inputs[1].value) || 0;
                const payment = parseFloat(inputs[2].value) || 0;
                const rate = parseFloat(inputs[3].value) || 0;
                if (balance > 0) debts.push({ name, balance, payment, rate, originalBalance: balance });
            });

            const validationError = validateDebts(debts);
            if (validationError) {
                showError(validationError);
                return;
            }

            lastCalculatedDebts = JSON.parse(JSON.stringify(debts));
            saveData();
            awardBadge('calculator');
            if (currentMethod === 'snowball') awardBadge('snowball');
            else awardBadge('avalanche');
            if (extraPaymentAmount > 0) awardBadge('extramiler');

            const snowballResult = calculatePayoff(JSON.parse(JSON.stringify(debts)), 'snowball');
            const avalancheResult = calculatePayoff(JSON.parse(JSON.stringify(debts)), 'avalanche');
            lastResults = { snowball: snowballResult, avalanche: avalancheResult };

            showComparison(snowballResult, avalancheResult);
            const selectedResult = currentMethod === 'snowball' ? snowballResult : avalancheResult;
            displayResults(selectedResult, debts);
            
            const noExtra = calculatePayoff(JSON.parse(JSON.stringify(debts)), currentMethod, 0);
            const interestSaved = noExtra.totalInterest - selectedResult.totalInterest;
            if (interestSaved >= 1000) awardBadge('saver');
            
            startCountdown(selectedResult.finalDate);
        }

        function calculatePayoff(debts, method, extra = extraPaymentAmount) {
            debts = debts.map(d => ({...d, balance: parseFloat(d.balance), paidOff: null}));
            if (method === 'snowball') debts.sort((a, b) => a.balance - b.balance);
            else debts.sort((a, b) => b.rate - a.rate);

            let month = 0, totalInterest = 0;
            const timeline = [], monthlyBreakdown = [];
            const maxMonths = 600;
            const startDate = new Date();

            while (month < maxMonths) {
                month++;
                let monthInterest = 0, extraPayment = extra;
                const targetDebt = debts.find(d => d.balance > 0.01);

                debts.forEach(debt => {
                    if (debt.balance > 0.01) {
                        const monthlyRate = debt.rate / 100 / 12;
                        const interest = parseFloat((debt.balance * monthlyRate).toFixed(2));
                        monthInterest += interest;
                        debt.balance = parseFloat((debt.balance + interest).toFixed(2));
                        const payment = Math.min(debt.payment, debt.balance);
                        debt.balance = parseFloat((debt.balance - payment).toFixed(2));

                        if (debt.balance <= 0.01) {
                            debt.balance = 0;
                            if (!debt.paidOff) {
                                debt.paidOff = month;
                                const date = new Date(startDate);
                                date.setMonth(date.getMonth() + month);
                                timeline.push({ month, date: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }), debt: debt.name });
                            }
                        }
                    }
                });

                totalInterest = parseFloat((totalInterest + monthInterest).toFixed(2));

                // Fixed extra payment logic - rolls to next debt in same month
                let extraApplied = 0;
                for (let debt of debts) {
                    if (debt.balance > 0.01 && extraPayment > 0) {
                        const payment = Math.min(extraPayment, debt.balance);
                        debt.balance = parseFloat((debt.balance - payment).toFixed(2));
                        extraPayment -= payment;
                        extraApplied += payment;
                        if (debt.balance <= 0.01 && !debt.paidOff) {
                            debt.balance = 0;
                            debt.paidOff = month;
                            const date = new Date(startDate);
                            date.setMonth(date.getMonth() + month);
                            timeline.push({ month, date: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }), debt: debt.name });
                        }
                        if (extraPayment <= 0) break;
                    }
                }

                monthlyBreakdown.push({
                    month,
                    target: targetDebt?.name || 'None',
                    minimum: debts.reduce((sum, d) => sum + (d.originalBalance > 0 ? d.payment : 0), 0),
                    extra: extraApplied,
                    total: debts.reduce((sum, d) => sum + d.payment, 0) + extraApplied,
                    status: targetDebt?.paidOff === month ? 'PAID OFF! üéâ' : 'Paying down'
                });

                if (debts.every(d => d.balance <= 0.01)) break;
            }

            const finalDate = new Date(startDate);
            finalDate.setMonth(finalDate.getMonth() + month);

            return { months: month, totalInterest, timeline, finalDate, debts, monthlyBreakdown };
        }

        function showComparison(snowball, avalanche) {
            document.getElementById('comparisonSection').style.display = 'grid';
            
            // DEBUG: Log the actual values
            console.log('Snowball:', snowball.months, 'months, $', snowball.totalInterest, 'interest');
            console.log('Avalanche:', avalanche.months, 'months, $', avalanche.totalInterest, 'interest');
            
            // Update the display values
            document.getElementById('snowballTime').textContent = snowball.months + ' months';
            document.getElementById('snowballInterest').textContent = formatMoney(snowball.totalInterest);
            document.getElementById('avalancheTime').textContent = avalanche.months + ' months';
            document.getElementById('avalancheInterest').textContent = formatMoney(avalanche.totalInterest);

            const snowballCard = document.getElementById('snowballCard');
            const avalancheCard = document.getElementById('avalancheCard');
            
            // Clear previous winner styling
            snowballCard.classList.remove('winner');
            avalancheCard.classList.remove('winner');
            
            const sbBadge = snowballCard.querySelector('.winner-badge');
            const avBadge = avalancheCard.querySelector('.winner-badge');
            if (sbBadge) sbBadge.remove();
            if (avBadge) avBadge.remove();

            // Calculate differences
            const monthsDiff = snowball.months - avalanche.months;
            const interestDiff = snowball.totalInterest - avalanche.totalInterest;
            
            // Determine winner based on which method is better overall
            // Score: -1 = worse, 0 = tie, 1 = better
            const snowballScore = (monthsDiff > 0 ? 1 : 0) + (interestDiff > 0 ? 1 : 0);
            const avalancheScore = (monthsDiff < 0 ? 1 : 0) + (interestDiff < 0 ? 1 : 0);
            
            if (avalancheScore > snowballScore) {
                // Avalanche is clearly better
                avalancheCard.classList.add('winner');
                const badge = createElement('span', { className: 'winner-badge', textContent: 'üèÜ Saves More $' });
                avalancheCard.appendChild(badge);
            } else if (snowballScore > avalancheScore) {
                // Snowball is clearly better (rare, but happens)
                snowballCard.classList.add('winner');
                const badge = createElement('span', { className: 'winner-badge', textContent: 'üèÜ Faster Win' });
                snowballCard.appendChild(badge);
            } else {
                // They're tied or trade-offs - highlight the differences
                if (monthsDiff === 0 && interestDiff === 0) {
                    // Exactly the same - show both as equal
                    const sbEqual = createElement('span', { className: 'winner-badge', textContent: '‚úì Same Result' });
                    sbEqual.style.background = '#666';
                    snowballCard.appendChild(sbEqual);
                } else if (monthsDiff === 0) {
                    // Same time, different interest
                    avalancheCard.classList.add('winner');
                    const badge = createElement('span', { className: 'winner-badge', textContent: `üí∞ Save ${formatMoney(Math.abs(interestDiff))}` });
                    avalancheCard.appendChild(badge);
                } else if (interestDiff === 0) {
                    // Same interest, different time
                    const faster = monthsDiff < 0 ? snowballCard : avalancheCard;
                    faster.classList.add('winner');
                    const badge = createElement('span', { className: 'winner-badge', textContent: `‚ö° ${Math.abs(monthsDiff)} mo faster` });
                    faster.appendChild(badge);
                } else {
                    // Trade-off: highlight what's better about each
                    if (monthsDiff < 0) {
                        // Snowball is faster
                        snowballCard.classList.add('winner');
                        const badge = createElement('span', { className: 'winner-badge', textContent: `‚ö° ${Math.abs(monthsDiff)} mo faster` });
                        snowballCard.appendChild(badge);
                    } else {
                        avalancheCard.classList.add('winner');
                        const badge = createElement('span', { className: 'winner-badge', textContent: `üí∞ Save ${formatMoney(Math.abs(interestDiff))}` });
                        avalancheCard.appendChild(badge);
                    }
                }
            }
            
            // Add comparison summary text
            const methodDesc = document.getElementById('methodDesc');
            const existingSummary = methodDesc.querySelector('.comparison-summary');
            if (existingSummary) existingSummary.remove();
            
            const summary = createElement('div', { className: 'comparison-summary' });
            summary.style.cssText = 'margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 0.9rem;';
            
            if (monthsDiff === 0 && interestDiff === 0) {
                summary.textContent = 'üìä Both methods give the exact same result!';
            } else {
                const timeText = monthsDiff === 0 ? 'same time' : monthsDiff < 0 ? `${Math.abs(monthsDiff)} months faster` : `${Math.abs(monthsDiff)} months slower`;
                const moneyText = interestDiff === 0 ? 'same interest' : interestDiff > 0 ? `saves ${formatMoney(Math.abs(interestDiff))}` : `costs ${formatMoney(Math.abs(interestDiff))} more`;
                summary.textContent = `üìä Avalanche is ${timeText} and ${moneyText}`;
            }
            methodDesc.appendChild(summary);
        }

        function displayResults(result, originalDebts) {
            const totalDebt = originalDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const totalPayment = originalDebts.reduce((sum, d) => sum + d.payment, 0) + extraPaymentAmount;

            document.getElementById('totalDebt').textContent = formatMoney(totalDebt);
            document.getElementById('totalPayments').textContent = formatMoney(totalPayment);
            document.getElementById('debtFreeDate').textContent = result.finalDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            const noExtra = calculatePayoff(JSON.parse(JSON.stringify(originalDebts)), currentMethod, 0);
            const interestSaved = Math.max(0, noExtra.totalInterest - result.totalInterest);
            document.getElementById('interestSaved').textContent = formatMoney(interestSaved);

            const tbody = document.getElementById('breakdownBody');
            clearElement(tbody);
            result.monthlyBreakdown.forEach(m => {
                const row = createElement('tr');
                if (m.status.includes('PAID')) row.className = 'paid-off';
                [m.month, m.target, `$${m.minimum.toLocaleString()}`, `$${m.extra.toLocaleString()}`, `$${m.total.toLocaleString()}`, m.status].forEach(cell => {
                    const td = createElement('td', { textContent: cell });
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            });

            const debtList = document.getElementById('debtList');
            clearElement(debtList);
            result.debts.forEach((debt, index) => {
                const original = originalDebts.find(d => d.name === debt.name);
                const isPaid = debt.paidOff > 0;
                const isCurrent = !isPaid && result.debts.findIndex(d => d.name === debt.name && !d.paidOff) === result.debts.findIndex(d => !d.paidOff);
                const percentPaid = isPaid ? 100 : Math.max(0, Math.min(100, ((original.originalBalance - debt.balance) / original.originalBalance * 100)));
                
                const item = createElement('div', { className: `debt-item${isPaid ? ' paid' : ''}${isCurrent ? ' current' : ''}` });
                
                const header = createElement('div', { className: 'debt-header' });
                const nameWrap = createElement('div');
                const nameEl = createElement('span', { className: 'debt-name', textContent: `${index + 1}. ${debt.name}` });
                nameWrap.appendChild(nameEl);
                
                if (isCurrent) {
                    const badge = createElement('span', { className: 'badge badge-current', textContent: '‚ö° Focus Here' });
                    nameWrap.appendChild(badge);
                }
                if (isPaid) {
                    const badge = createElement('span', { className: 'badge badge-paid', textContent: '‚úì Paid Off' });
                    nameWrap.appendChild(badge);
                }
                if (!isPaid && !isCurrent) {
                    const badge = createElement('span', { className: 'badge badge-upcoming', textContent: 'Up Next' });
                    nameWrap.appendChild(badge);
                }
                
                const balanceEl = createElement('div', { className: 'debt-balance', textContent: formatMoney(original.originalBalance) });
                header.append(nameWrap, balanceEl);
                
                const progress = createElement('div', { className: 'progress-bar' });
                const fill = createElement('div', { className: 'progress-fill' });
                fill.style.width = `${percentPaid}%`;
                const progressText = createElement('div', { className: 'progress-text', textContent: `${percentPaid.toFixed(0)}% Complete` });
                progress.append(fill, progressText);
                
                const details = createElement('div', { className: 'debt-details' });
                const buildDetail = (label, value) => {
                    const item = createElement('div', { className: 'detail-item' });
                    item.append(
                        createElement('div', { className: 'detail-label', textContent: label }),
                        createElement('div', { className: 'detail-value', textContent: value })
                    );
                    return item;
                };
                details.append(
                    buildDetail('Payment', `${formatMoney(original.payment)}/mo`),
                    buildDetail('Rate', `${original.rate}%`),
                    buildDetail(isPaid ? 'Paid Off' : 'Order', isPaid ? `${debt.paidOff} mo` : `#${index + 1}`)
                );
                
                item.append(header, progress, details);
                debtList.appendChild(item);
            });

            const paidOffCount = result.debts.filter(d => d.paidOff > 0).length;
            if (paidOffCount >= result.debts.length / 2) awardBadge('halfway');
            if (paidOffCount > 0) awardBadge('firstdebt');

            const celebration = document.getElementById('celebration');
            celebration.classList.add('show');
            const celebrationMessage = document.getElementById('celebrationMessage');
            clearElement(celebrationMessage);
            const strong = createElement('strong', { textContent: result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) });
            celebrationMessage.append(
                document.createTextNode("Following this plan, you'll be completely debt-free by "),
                strong,
                document.createTextNode('.'),
                document.createElement('br'),
                document.createTextNode('Imagine how that will feel!')
            );

            document.getElementById('shareDebtFreeDate').textContent = result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('shareMessage').textContent = 
                `I'm on track to pay off ${formatMoney(totalDebt)} in debt using the ${currentMethod} method${extraPaymentAmount > 0 ? ' with ' + formatMoney(extraPaymentAmount) + '/mo extra' : ''}!`;
            const shareBadges = document.getElementById('shareBadges');
            clearElement(shareBadges);
            const badges = { explorer: 'üîç', calculator: 'üßÆ', snowball: 'üèîÔ∏è', avalanche: '‚õ∞Ô∏è', extramiler: '‚ö°', debtfree: 'üéâ', firstdebt: 'üéØ', halfway: 'üìà', saver: 'üí∞' };
            earnedBadges.forEach(id => {
                if (!badges[id]) return;
                const badge = createElement('span');
                badge.style.fontSize = '1.5rem';
                badge.style.margin = '0 5px';
                badge.textContent = badges[id];
                shareBadges.appendChild(badge);
            });

            document.getElementById('results').classList.add('show');
        }

        function formatMoney(amount) {
            return '$' + Math.round(amount).toLocaleString();
        }

        function printPlan() { window.print(); }
        
        async function downloadPDF() {
            const element = document.getElementById('results');
            const canvas = await html2canvas(element, { scale: 2 });
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 210;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
            pdf.save('debt-payoff-plan.pdf');
        }

        function exportCalendar() {
            if (!lastResults) return;
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Debt Snowball//EN\n';
            result.timeline.forEach(event => {
                const date = new Date();
                date.setMonth(date.getMonth() + event.month);
                const dateStr = date.toISOString().replace(/[-:]/g, '').split('.')[0];
                icsContent += `BEGIN:VEVENT\nDTSTART;VALUE=DATE:${dateStr.split('T')[0]}\nSUMMARY:üéâ ${event.debt} Paid Off!\nEND:VEVENT\n`;
            });
            icsContent += 'END:VCALENDAR';
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'debt-payoff-dates.ics';
            link.click();
        }

        function exportCSV() {
            if (!lastResults) {
                showError('Calculate your plan first!');
                return;
            }
            
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const totalPayment = lastCalculatedDebts.reduce((sum, d) => sum + d.payment, 0) + extraPaymentAmount;
            
            let csv = 'DEBT PAYOFF PLAN\n';
            csv += `Generated,${new Date().toLocaleDateString()}\n`;
            csv += `Method,${currentMethod === 'snowball' ? 'Debt Snowball' : 'Debt Avalanche'}\n`;
            csv += `Total Debt,$${totalDebt}\n`;
            csv += `Monthly Payment,$${totalPayment}\n`;
            csv += `Debt-Free Date,${result.finalDate.toLocaleDateString()}\n`;
            csv += `Total Interest,$${result.totalInterest.toFixed(2)}\n`;
            csv += `Months to Payoff,${result.months}\n\n`;
            
            csv += 'DEBT SUMMARY\n';
            csv += 'Name,Original Balance,Interest Rate,Min Payment,Payoff Month\n';
            result.debts.forEach((debt) => {
                const original = lastCalculatedDebts.find(d => d.name === debt.name);
                csv += `"${debt.name}",${original.originalBalance},${original.rate}%,${original.payment},${debt.paidOff || 'N/A'}\n`;
            });
            csv += '\n';
            
            csv += 'MONTHLY PAYMENT SCHEDULE\n';
            csv += 'Month,Date,Focus Debt,Payment Amount,Extra Payment,Total Paid,Status\n';
            
            result.monthlyBreakdown.forEach(m => {
                const date = new Date();
                date.setMonth(date.getMonth() + m.month);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                csv += `${m.month},${dateStr},"${m.target}",${m.minimum},${m.extra},${m.total},"${m.status}"\n`;
            });
            
            csv += '\nMILESTONES\n';
            csv += 'Month,Date,Debt Paid Off,Amount\n';
            result.timeline.forEach(event => {
                const original = lastCalculatedDebts.find(d => d.name === event.debt);
                csv += `${event.month},${event.date},"${event.debt}",${original ? original.originalBalance : 0}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `debt-payoff-plan-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function showShareModal() { 
            document.getElementById('shareModal').classList.add('show'); 
        }
        
        async function downloadImage() {
            const element = document.getElementById('shareContent');
            const canvas = await html2canvas(element, { scale: 2, backgroundColor: '#ffffff' });
            const link = document.createElement('a');
            link.download = 'my-debt-free-journey.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function shareTwitter() {
            if (!lastResults) return;
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            const text = `I'm on track to be debt-free by ${result.finalDate.toLocaleDateString('en-US', {month:'long', year:'numeric'})}! Working to pay off ${formatMoney(totalDebt)} using the ${currentMethod} method. üí™`;
            window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(text), '_blank');
        }

        function closeModal(modalId) { 
            document.getElementById(modalId).classList.remove('show'); 
        }

        // Close modal on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.show').forEach(m => m.classList.remove('show'));
            }
        });

        // Close modal on outside click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });

        function generateColoringTracker() {
            if (!lastResults) {
                showError('Calculate your plan first!');
                return;
            }
            
            const result = currentMethod === 'snowball' ? lastResults.snowball : lastResults.avalanche;
            const totalDebt = lastCalculatedDebts.reduce((sum, d) => sum + d.originalBalance, 0);
            
            const trackerWindow = window.open('', '_blank', 'width=800,height=1000');
            
            let trackerHTML = `<!DOCTYPE html>
<html>
<head>
    <title>My Debt-Free Coloring Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #005288;
        }
        .header h1 {
            color: #005288;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .goal-date {
            color: #2E7D32;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .debt-thermometer {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 10px;
        }
        .thermometer-title {
            text-align: center;
            font-size: 1.2rem;
            color: #005288;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .thermometer {
            width: 100%;
            height: 60px;
            border: 3px solid #333;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            background: white;
        }
        .thermometer-sections {
            display: flex;
            height: 100%;
        }
        .therm-section {
            flex: 1;
            border-right: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #666;
        }
        .therm-section:last-child { border-right: none; }
        .labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        .debt-blocks {
            margin: 30px 0;
        }
        .debt-blocks h2 {
            color: #005288;
            margin-bottom: 20px;
            text-align: center;
        }
        .debt-block {
            margin-bottom: 25px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
        .debt-name {
            font-weight: bold;
            color: #005288;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .debt-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .blocks-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .payoff-block {
            width: 35px;
            height: 35px;
            border: 2px solid #333;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #999;
            background: white;
        }
        .milestone-section {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        .milestone-section h2 {
            color: #005288;
            margin-bottom: 15px;
        }
        .milestone {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .milestone-checkbox {
            width: 25px;
            height: 25px;
            border: 2px solid #333;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .milestone-text {
            flex: 1;
        }
        .milestone-date {
            color: #2E7D32;
            font-weight: bold;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #999;
            font-size: 0.8rem;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        @media print {
            body { padding: 20px; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ My Debt-Free Journey</h1>
        <div class="goal-date">Goal: ${result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
    </div>
    
    <div class="debt-thermometer">
        <div class="thermometer-title">TOTAL DEBT THERMOMETER</div>
        <div class="thermometer">
            <div class="thermometer-sections">
                <div class="therm-section">Start</div>
                <div class="therm-section">25%</div>
                <div class="therm-section">50%</div>
                <div class="therm-section">75%</div>
                <div class="therm-section">PAID!</div>
            </div>
        </div>
        <div class="labels">
            <span>$${totalDebt.toLocaleString()}</span>
            <span>Color from left to right as you pay!</span>
            <span>$0</span>
        </div>
    </div>
    
    <div class="debt-blocks">
        <h2>üìä Individual Debt Trackers</h2>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">Color one box for each payment you make!</p>
`;

            result.debts.forEach((debt, index) => {
                const original = lastCalculatedDebts.find(d => d.name === debt.name);
                const numBlocks = Math.min(Math.ceil(original.originalBalance / original.payment), 20);
                
                trackerHTML += `
        <div class="debt-block">
            <div class="debt-name">${index + 1}. ${debt.name}</div>
            <div class="debt-info">Starting: $${original.originalBalance.toLocaleString()} | Payment: ~$${Math.round(original.originalBalance / numBlocks).toLocaleString()} per box</div>
            <div class="blocks-container">
`;
                
                for (let i = 0; i < numBlocks; i++) {
                    const remaining = original.originalBalance - (i * (original.originalBalance / numBlocks));
                    const label = remaining > 0 ? `$${Math.round(remaining/1000)}k` : 'PAID!';
                    trackerHTML += `                <div class="payoff-block">${label}</div>\n`;
                }
                
                trackerHTML += `            </div>
        </div>
`;
            });
            
            trackerHTML += `
    </div>
    
    <div class="milestone-section">
        <h2>üèÜ Victory Milestones</h2>
        <p style="color: #666; margin-bottom: 15px;">Check off each milestone as you achieve it!</p>
`;

            result.timeline.forEach(event => {
                trackerHTML += `
        <div class="milestone">
            <div class="milestone-checkbox"></div>
            <div class="milestone-text">
                <strong>${event.debt}</strong> paid off!
                <div class="milestone-date">${event.date}</div>
            </div>
        </div>
`;
            });
            
            trackerHTML += `
        <div class="milestone">
            <div class="milestone-checkbox"></div>
            <div class="milestone-text">
                <strong>üéâ DEBT FREE!</strong>
                <div class="milestone-date">${result.finalDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
            </div>
        </div>
    </div>
    
    <div class="footer no-print">
        <p>Generated by DebtSnowballCalculator.com</p>
        <p style="margin-top: 10px;"><button onclick="window.print()" style="padding: 10px 20px; background: #005288; color: white; border: none; border-radius: 5px; cursor: pointer;">üñ®Ô∏è Print This Page</button></p>
    </div>
</body>
</html>`;
            
            trackerWindow.document.write(trackerHTML);
            trackerWindow.document.close();
        }
    </script>
</body>
</html>